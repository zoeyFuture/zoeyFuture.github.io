<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="前段杂货铺，正在储货中...">
<meta property="og:type" content="website">
<meta property="og:title" content="前端小谁谁">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="前端小谁谁">
<meta property="og:description" content="前段杂货铺，正在储货中...">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="赵伟">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>前端小谁谁</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">前端小谁谁</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">前端小猿，努力工作</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/24/Node%20ORM%20Sequelize%20%E5%B0%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/24/Node%20ORM%20Sequelize%20%E5%B0%8F%E8%AE%B0/" itemprop="url">Node ORM Sequelize 小记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-24T14:22:17+08:00">
                2020-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="线程与进程"><a href="#线程与进程" class="headerlink" title="线程与进程"></a>线程与进程</h1><h2 id="进程（Process）"><a href="#进程（Process）" class="headerlink" title="进程（Process）"></a>进程（Process）</h2><p>进程是一个具有一定独立功能的程序在一个数据集上的一次动态执行的过程，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。</p>
<p>进程是一种抽象的概念，从来没有统一的标准定义。<br>进程一般由程序、数据集合和进程控制块三部分组成：</p>
<ul>
<li>程序用于描述进程要完成的功能，是控制进程执行的指令集；</li>
<li>数据集合是程序在执行时所需要的数据和工作区；</li>
<li>程序控制块(Program Control Block，简称PCB)，包含进程的描述信息和控制信息，是进程存在的唯一标志。</li>
</ul>
<p>在某一时刻，一个 CPU 中只能运行一个进程，它是在各个进程之间来回切换的，每个进程执行的速度也不确定。</p>
<h2 id="线程（Thread）"><a href="#线程（Thread）" class="headerlink" title="线程（Thread）"></a>线程（Thread）</h2><p>线程是程序执行中一个单一的顺序控制流程，是程序执行流的最小单元，是处理器调度和分派的基本单位。</p>
<p>线程的运行状态：<br><img src="https://gw.aikan.miguvideo.com/ifs/img/b45a60769b3655c321ec921b36f99241_2.png" alt=""></p>
<h2 id="进程与线程的区别与联系"><a href="#进程与线程的区别与联系" class="headerlink" title="进程与线程的区别与联系"></a>进程与线程的区别与联系</h2><ol>
<li>线程是程序执行的最小单位，而进程是操作系统分配资源的最小单位；</li>
<li>一个进程由一个或多个线程组成，线程是一个进程中代码的不同执行路线；</li>
<li>进程之间相互独立，但同一进程下的各个线程之间共享程序的内存空间(包括代码段、数据集、堆等)及一些进程级的资源(如打开文件和信号)，某进程内的线程在其它进程不可见；</li>
<li>调度和切换：线程上下文切换比进程上下文切换要快得多。</li>
</ol>
<p>线程与进程关系的示意图：</p>
<p><img src="https://gw.aikan.miguvideo.com/ifs/img/12204f0ca1fb0b5f996991f02fb8b6c9_1.png" alt="111"></p>
<p>扩展：<a href="https://juejin.cn/post/6844903756866256909" target="_blank" rel="noopener">关于 cpu 进程调度算法</a></p>
<h2 id="JavaScript中的线程与进程"><a href="#JavaScript中的线程与进程" class="headerlink" title="JavaScript中的线程与进程"></a>JavaScript中的线程与进程</h2><p>众所周知，javascript是单线程的，这是由于在早期js作为脚本语言只是用来辅助优化用户交互的，并没有赋予多线程能力。</p>
<p>针对现在的js的线程和进程处理能力，主要区分为浏览器环境和node环境</p>
<h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p>浏览器是多进程的，系统给每个进程分配了资源（CPU、内存等），每打开一个Tab页，就相当于创建了一个独立的浏览器进程。</p>
<p>浏览器主要包含了下面这个进程：</p>
<ul>
<li><p>Browser进程：浏览器的主进程，有且只有一个，负责协调和主控，只要有以下作用</p>
<ul>
<li>负责浏览器界面显示，与用户交互，如前进、后退等</li>
<li>负责各个页面的管理、创建和销毁其他进程</li>
<li>将Renderer进程得到的内存中的Bitmap，绘制到用户界面上</li>
<li>网络资源的管理、下载等</li>
</ul>
</li>
<li><p>Renderer进程（浏览器渲染进程，浏览器内核，内部是多线程的）：默认每一个Tab页面都是一个进程，互不影响。主要作用是 页面渲染、脚本执行、事件处理等</p>
</li>
<li><p>GPU进程：最多只有一个，用户3D绘制等</p>
</li>
<li><p>第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建</p>
</li>
</ul>
<h4 id="浏览器多进程的优势"><a href="#浏览器多进程的优势" class="headerlink" title="浏览器多进程的优势"></a>浏览器多进程的优势</h4><p>相比较与单进程浏览器，多进程有如下优势：</p>
<ul>
<li>避免单个Page Crash影响到整个浏览器</li>
<li>避免第三方插件Crash于影响到整个浏览器</li>
<li>多进程充分利用多核优势</li>
<li>方便使用沙盒模型隔离插件等进程，提高浏览器的稳定性</li>
</ul>
<h4 id="渲染进程"><a href="#渲染进程" class="headerlink" title="渲染进程"></a>渲染进程</h4><p>对于前端开发人员来说，接触到最多的可能就是浏览器的渲染进程，渲染进程内部是多线程的，主要包括以下几个线程：</p>
<ol>
<li>GUI渲染线程</li>
</ol>
<ul>
<li>负责渲染浏览器界面，解析HTML、CSS、构建DOM树和RenderObject树，布局和绘制等</li>
<li>当界面需要重绘（Repaint）或由于某种操作引发回流(Reflow)时，改建成就绘制执行</li>
<li>注意：GUI渲染线程和JS引擎线程是互斥的，当JS引擎执行时GUI线程绘被挂起（相当于被冻结），GUI更新会被保存在一个队列中等JS引擎空闲时立即被执行</li>
</ul>
<ol start="2">
<li>JS引擎线程</li>
</ol>
<ul>
<li>JS引擎线程也被成为JS内核，负责处理JavaScript脚本程序，如V8引擎</li>
<li>JS引擎线程负责解析JavaScript脚本，运行代码</li>
<li>JS引擎一直等待着任务队列中任务的到来，然后加以处理，一个Tab页（Renderer进程）中无论什么时候只有一个JS线程在执行JS程序</li>
<li>同样注意，GUI渲染线程与JS引擎线程是互斥的，所以如果JS执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。</li>
</ul>
<ol start="3">
<li>事件触发线程</li>
</ol>
<ul>
<li>归属于浏览器而不是JS引擎，用来控制事件循环</li>
<li>当JS引擎执行代码块如setTimeout时（也可来自浏览器内核的其他线程，如鼠标点击、Ajax异步请求等），会将对应的任务添加到事件线程中</li>
<li>当对应的事件符合触发条件时被触发时，事件触发线程会把事件添加到等待处理队列中，等待JS引擎的处理</li>
<li>注意：由于JS的但线程关系，所以这些待处理队列中的事件都得排队等待JS引擎处理（当JS引擎空闲时才会去执行）</li>
</ul>
<ol start="4">
<li>定时器触发线程</li>
</ol>
<ul>
<li>setInterval与setTimeout所在的线程</li>
<li>浏览器定时器并不是有JavaScript引擎计数的（因为JavaScript引擎是但线程的，如果处于阻塞线程状态就会影响计时的准确性）</li>
<li>通过单线程来计时并触发定时器事件（计时完毕后，添加到事件对勒中，等待JS引擎空闲后执行）</li>
<li>注意：W3C在HTML标准中规定，要求setTimeout中低于4ms的时间间隔算为4ms</li>
</ul>
<ol start="5">
<li>异步Http请求线程</li>
</ol>
<ul>
<li>XMLHttpRequest在连接后，是通过浏览器新开一个线程来请求数据</li>
<li>当监测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将回调放置事件队列中，再由JavaScript引擎执行</li>
</ul>
<h4 id="从Event-Loop谈JS的运行机制"><a href="#从Event-Loop谈JS的运行机制" class="headerlink" title="从Event Loop谈JS的运行机制"></a>从Event Loop谈JS的运行机制</h4><p>到这里我们已经知道了JS引擎是单线程的，在浏览器Event Loop中会涉及到下面几个线程概念：</p>
<ul>
<li>JS引擎线程</li>
<li>事件触发线程</li>
<li>定时触发线程</li>
</ul>
<p>对于JS中的其他概念如下：</p>
<ul>
<li>JS分为同步任务和异步任务</li>
<li>同步任务都在主线程上执行，形成一个执行栈</li>
<li>主线程之外，事件触发线程管理者一个任务队列，只要异步任务有了执行结果，就在任务队列中放置一个事件</li>
<li>一旦执行栈中的所有同步任务执行完毕（此时JS引擎空闲），系统就会读取任务队列，将可运行的异步任务添加到执行栈中，开始继续执行</li>
</ul>
<p><img src="https://gw.aikan.miguvideo.com/ifs/img/682ca4ec5157e7dac5f8dcecb2a7e0ec_4.png" alt=""></p>
<h4 id="JS多线程的实现"><a href="#JS多线程的实现" class="headerlink" title="JS多线程的实现"></a>JS多线程的实现</h4><p>由于JS引擎是单线程的，当JS执行事件过长会阻塞页面渲染，那么真多CPU密集型的计算该如何处理呢？</p>
<p>针对这样的问题，在HTML5中支持了 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener">Web Worker</a></p>
<p>在MDN的解释中，一个Worker是使用一个构造函数创建的一个对象(e.g.worker())运行一个命名的JavaScript文件，这个文件包含将在工作线程中运行的代码</p>
<p>workers运行在一个全局上下文中，不同于当前的window环境，所以在worker线程中，是不能通过window获取当前全局范围的数据</p>
<p>可以这么理解：</p>
<ul>
<li>创建Worker时，JS引擎项浏览器申请新开一个子线程（子线程是浏览器创建的，完全手祝线程控制，并且不能操作DOM）</li>
<li>JS引擎线程与worker线程间通过特定的方式通信（postMessage API，需要通过序列化对象来与线程交互特定的数据）</li>
</ul>
<p>扩展：<a href="https://juejin.cn/post/6844903589924569101" target="_blank" rel="noopener">关于Web Worker(专有) 和 SharedWorker（共享）线程通信</a><br><a href="https://juejin.cn/post/6844903736238669837" target="_blank" rel="noopener">https://juejin.cn/post/6844903736238669837</a></p>
<p>一个Nodejs服务的简单构成：一个进程 + 一个线程 + 一个事件循环 + 一个 JS 引擎 + 一个 Node.js 实例</p>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>Node.js 是 Javascript 在服务端的运行环境，构建在 chrome 的 V8 引擎之上，基于事件驱动、非阻塞I/O模型，充分利用操作系统提供的异步 I/O 进行多任务的执行，适合于 I/O 密集型的应用场景，因为异步，程序无需阻塞等待结果返回，而是基于回调通知的机制，原本同步模式等待的时间，则可以用来处理其它任务</p>
<blockquote>
<p>科普：在 Web 服务器方面，著名的 Nginx 也是采用此模式（事件驱动），避免了多线程的线程创建、线程上下文切换的开销，Nginx 采用 C 语言进行编写，主要用来做高性能的 Web 服务器，不适合做业务。</p>
</blockquote>
<h4 id="Node中的进程"><a href="#Node中的进程" class="headerlink" title="Node中的进程"></a>Node中的进程</h4><p>nodejs中的进程Process是一个全局对象，给我们提供了进程相关信息，针对Node中的多进程模型，则是利用Node <a href="http://nodejs.cn/api/cluster.html#cluster_cluster" target="_blank" rel="noopener">Cluster模块</a>和 <a href="http://nodejs.cn/api/child_process.html#child_process_child_process" target="_blank" rel="noopener">child_process模块</a>，具体可以查看eggjs官方文档：<a href="https://eggjs.org/zh-cn/core/cluster-and-ipc.html" target="_blank" rel="noopener">多进程模型和进程间通讯</a></p>
<h5 id="Node中的多进程"><a href="#Node中的多进程" class="headerlink" title="Node中的多进程"></a>Node中的多进程</h5><p>利用<a href="http://nodejs.cn/api/cluster.html#cluster_cluster" target="_blank" rel="noopener">Cluster模块</a>和 <a href="http://nodejs.cn/api/child_process.html#child_process_child_process" target="_blank" rel="noopener">child_process模块</a>可以实现多进程</p>
<ul>
<li>守护进程</li>
</ul>
<p>后台运行的特殊进程，不受任何终端控制的进程。</p>
<ul>
<li>工作进程</li>
</ul>
<h5 id="Node中的多线程"><a href="#Node中的多线程" class="headerlink" title="Node中的多线程"></a>Node中的多线程</h5><p>利用<a href="http://nodejs.cn/api/worker_threads.html#worker_threads_worker_threads" target="_blank" rel="noopener">worker_threads（工作线程）模块</a>可以实现多线程</p>
<p>worker_threads模块提供了同时运行多个线程的能力</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li>[1] <a href="https://eggjs.org/zh-cn/core/cluster-and-ipc.html" target="_blank" rel="noopener">Eggjs 多进程模型和进程间通讯</a></li>
<li>[2] <a href="https://www.cnblogs.com/zhangguicheng/p/12092058.html" target="_blank" rel="noopener">深入理解 Node.js 进程与线程</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/27/Js%E9%98%9F%E5%88%97%E5%87%BD%E6%95%B0%E5%92%8C%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/27/Js%E9%98%9F%E5%88%97%E5%87%BD%E6%95%B0%E5%92%8C%E5%BC%82%E6%AD%A5%E6%89%A7%E8%A1%8C%E8%A7%A3%E6%9E%90/" itemprop="url">Js队列函数和异步执行解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-27T19:58:43+08:00">
                2020-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考文章： <a href="https://www.php.cn/js-tutorial-373081.html" target="_blank" rel="noopener">https://www.php.cn/js-tutorial-373081.html</a> </p>
<p>前言：</p>
<p>​    今天看到一篇关于JavaScript流程控制题目，描述如下：</p>
<p> <img src="https://filesystem.api.jituancaiyun.com/sfs/file?digest=fidc201ee6863509a9ca4778d54abb7a037&amp;fileType=2" alt="img"> </p>
<p>从题目打印结果分析，肯定涉及到函数队列相关</p>
<p>首先来链接写函数队列调用顺序相关：</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/27/Docker%20%E5%A6%82%E4%BD%95%E9%83%A8%E7%BD%B2%20Node%20%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/27/Docker%20%E5%A6%82%E4%BD%95%E9%83%A8%E7%BD%B2%20Node%20%E5%BA%94%E7%94%A8/" itemprop="url">Docker 如何部署 Node 应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-27T19:58:43+08:00">
                2020-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://blog.papercut.com/wp-content/uploads/2019/02/docker-logo-1024x597.png" alt=""></p>
<blockquote>
<p>图片来源：<a href="https://blog.papercut.com/wp-content/uploads/2019/02/docker-logo-1024x597.png" target="_blank" rel="noopener">https://blog.papercut.com/wp-content/uploads/2019/02/docker-logo-1024x597.png</a></p>
</blockquote>
<p>[TOC]</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><ul>
<li>Dockerfile</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node镜像</span></span><br><span class="line">FROM node:12.18.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个是容器中的文件目录</span></span><br><span class="line">RUN mkdir -p /home/admin/doc-node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line">WORKDIR /home/admin/doc-node</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝package.json文件到工作目录</span></span><br><span class="line"><span class="comment"># !!重要：package.json需要单独添加。</span></span><br><span class="line"><span class="comment"># Docker在构建镜像的时候，是一层一层构建的，仅当这一层有变化时，重新构建对应的层。</span></span><br><span class="line"><span class="comment"># 如果package.json和源代码一起添加到镜像，则每次修改源码都需要重新安装npm模块，这样没有必要。</span></span><br><span class="line"><span class="comment"># 所以，正确的顺序是:</span></span><br><span class="line"><span class="comment"># 添加package.json；</span></span><br><span class="line"><span class="comment"># 安装npm模块；</span></span><br><span class="line"><span class="comment"># 添加源代码。</span></span><br><span class="line">COPY package.json /home/admin/doc-node/package.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装npm依赖(使用淘宝的镜像源)</span></span><br><span class="line"><span class="comment"># 如果使用的境外服务器，无需使用淘宝的镜像源，即改为`RUN npm i`。</span></span><br><span class="line">RUN npm i --production --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝所有源代码到工作目</span></span><br><span class="line">COPY ./dist /home/admin/doc-node/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露容器端口</span></span><br><span class="line">EXPOSE 9423</span><br><span class="line"></span><br><span class="line">CMD npm run <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<ul>
<li>构建镜像</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t doc-node .</span><br></pre></td></tr></table></figure>
<p>构建结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">➜  doc-node git:(master) ✗ docker build -t doc-node .    </span><br><span class="line">Sending build context to Docker daemon  546.6MB</span><br><span class="line">Step 1/8 : FROM node:12.18.3-alpine</span><br><span class="line"> ---&gt; 18f4bc975732</span><br><span class="line">Step 2/8 : RUN mkdir -p /home/admin/doc-node</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 4c02163f06fd</span><br><span class="line">Step 3/8 : WORKDIR /home/admin/doc-node</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c5028665498d</span><br><span class="line">Step 4/8 : COPY package.json /home/admin/doc-node/package.json</span><br><span class="line"> ---&gt; e5234ca8c018</span><br><span class="line">Step 5/8 : RUN npm i --production --registry=https://registry.npm.taobao.org</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 2c0158284144</span><br><span class="line">Removing intermediate container 2c0158284144</span><br><span class="line"> ---&gt; 1b1c86bca5a9</span><br><span class="line">Step 6/8 : COPY ./dist /home/admin/doc-node/</span><br><span class="line"> ---&gt; 4fb32124c0dc</span><br><span class="line">Step 7/8 : EXPOSE 9423</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 7090c27bd6c1</span><br><span class="line">Removing intermediate container 7090c27bd6c1</span><br><span class="line"> ---&gt; 2a8df7c21c1a</span><br><span class="line">Step 8/8 : CMD npm run <span class="built_in">test</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 52b38538ff92</span><br><span class="line">Removing intermediate container 52b38538ff92</span><br><span class="line"> ---&gt; 9e045ca76af7</span><br><span class="line">Successfully built 9e045ca76af7</span><br><span class="line">Successfully tagged doc-node:latest</span><br></pre></td></tr></table></figure>

<ul>
<li>运行容器</li>
</ul>
<p>查看构建的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p>使用构建的进行，实例一个容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name docNode -p 9423:9423 -d 9e045ca76af7</span><br></pre></td></tr></table></figure>

<p>运行完毕就可以看到容器实例</p>
<ul>
<li>提交镜像</li>
</ul>
<p>镜像构建完毕后，可以提交到docker hub上，官网地址：<a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p>
<p>提前前需要打一个tag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag 6f744b5d6dad zhaowei666/doc-node:v1.0</span><br></pre></td></tr></table></figure>

<p>之后提交镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push zhaowei666/doc-node:v1.0</span><br></pre></td></tr></table></figure>

<p>当出现下面打印时，则表示上传成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">The push refers to repository [docker.io/zhaowei666/doc-node]</span><br><span class="line">696f9fe6abcf: Pushed </span><br><span class="line">15bb3400b366: Pushed </span><br><span class="line">7ebf5d8bef67: Pushed </span><br><span class="line">d3eefd1127e9: Pushed </span><br><span class="line">aedafbecb0b3: Mounted from library/node </span><br><span class="line">db809908a198: Mounted from library/node </span><br><span class="line">1b235e8e7bda: Mounted from library/node </span><br><span class="line">3e207b409db3: Mounted from library/node </span><br><span class="line">v1.0: digest: sha256:a18d7b8d4ccd1dbd4fcd0a6f3c2854e7dd0e9480af6c3e679778b2808164f20b size: 1993</span><br></pre></td></tr></table></figure>

<ul>
<li>下载镜像</li>
</ul>
<p>镜像上传之后，部署到其他环境时，查询并下载镜像运行容器即可</p>
<p>下载镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull zhaowei666/doc-node:v1.0</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/27/TS%20%E5%9F%BA%E7%A1%80%E7%B3%BB%E5%88%97%E4%B9%8Btype%E5%92%8Cinterface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/09/27/TS%20%E5%9F%BA%E7%A1%80%E7%B3%BB%E5%88%97%E4%B9%8Btype%E5%92%8Cinterface/" itemprop="url">TS 基础系列之type和interface</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-09-27T19:58:43+08:00">
                2020-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1573783262,3178598711&fm=26&gp=0.jpg" alt=""></p>
<blockquote>
<p>图片来源：<a href="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1573783262,3178598711&amp;fm=26&amp;gp=0.jpg" target="_blank" rel="noopener">https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1573783262,3178598711&amp;fm=26&amp;gp=0.jpg</a></p>
</blockquote>
<p>[TOC]</p>
<h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一 前言"></a>一 前言</h2><p>在ts中type和interface关键字都可用来定义数据类型，在很多开源项目中都会大量用到，那这两者到底有什么区别，使用场景有什么不同呢。下面我们仔细来探讨一下</p>
<h2 id="二-正文"><a href="#二-正文" class="headerlink" title="二 正文"></a>二 正文</h2><h3 id="2-1-interface（接口）"><a href="#2-1-interface（接口）" class="headerlink" title="2.1 interface（接口）"></a>2.1 interface（接口）</h3><p>interface表示接口，在ts中也可以用来定义数据类型，但是仅限于对象、函数、类类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line">interface User &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型</span></span><br><span class="line">interface SetUser &#123;</span><br><span class="line">    (name: string, <span class="attr">age</span>: number):  <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类类型接口</span></span><br><span class="line">interface ClockInterface &#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span> <span class="title">implements</span> <span class="title">ClockInterface</span> </span>&#123;</span><br><span class="line">  currentTime: <span class="built_in">Date</span>;</span><br><span class="line">  setTime(d: <span class="built_in">Date</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.currentTime = d;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">constructor</span>(h: number, m: number) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>interface定义的类型是可以继承的，并且可以多继承</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">interface Cat &#123;</span><br><span class="line">    eat: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Dog &#123;</span><br><span class="line">    pull: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型继承</span></span><br><span class="line">interface Zoom extends Cat, Dog &#123;</span><br><span class="line">    play: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> zoom: Zoom = &#123;</span><br><span class="line">    eat: <span class="string">'疯狂吃'</span>,</span><br><span class="line">    pull: <span class="string">'疯狂拉'</span>,</span><br><span class="line">    play: <span class="string">'疯狂撸'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-2-type（类型别名）"><a href="#2-2-type（类型别名）" class="headerlink" title="2.2 type（类型别名）"></a>2.2 type（类型别名）</h3><p>ts中type表示是类型别名，即给类型起一个新的名字。type有时候和interface非常像，但是type可以用于基本类型、联合类型、元祖以及其他任何需要手写的类型</p>
<ul>
<li><p>基本类型</p>
<p>type可以对基本类型重命名，这里不会新建一个类型，只是创建一个新名字 IString 来引用 string类型</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本类型别名</span></span><br><span class="line">type IString = string; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name1: IString = <span class="string">'张三'</span>;</span><br><span class="line"><span class="keyword">const</span> name2: string = <span class="string">'李四'</span>;</span><br></pre></td></tr></table></figure>
<p>type</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line">type User = &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型</span></span><br><span class="line">type SetUser = <span class="function">(<span class="params">name: string, age: number</span>) =&gt;</span> <span class="keyword">void</span>;</span><br></pre></td></tr></table></figure>

<p>interface</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line">interface User &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型</span></span><br><span class="line">interface SetUser &#123;</span><br><span class="line">    (name: string, <span class="attr">age</span>: number):  <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>声明对象或函数时，使用方式都是一样的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user: User = &#123;</span><br><span class="line">    name: <span class="string">'张三'</span>,</span><br><span class="line">    age: <span class="number">24</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> setUser: SetUser;</span><br><span class="line"></span><br><span class="line">setUser = <span class="function">(<span class="params">name: string, age: number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'SetUser:'</span>, name, age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setUser(<span class="string">'10'</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>类型继承（extends）</li>
</ul>
<p>type和interface都要支持继承（extends），并且两者都可以相互继承，也就是说type可以extend interface，interface也可以extends type，仅在语法上有区别</p>
<p>type</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line">type User = &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型继承: 用以扩展字段</span></span><br><span class="line">type Teacher = User &amp; &#123;</span><br><span class="line">    education: string, <span class="comment">// 学历</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明变量</span></span><br><span class="line"><span class="keyword">const</span> teacher: Teacher = &#123;</span><br><span class="line">    name: <span class="string">'张三'</span>,</span><br><span class="line">    age: <span class="number">24</span>,</span><br><span class="line">    education: <span class="string">'本科'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>interface</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line">interface User &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型继承 用以扩展字段</span></span><br><span class="line">interface Teacher extends User &#123;</span><br><span class="line">    education: string, <span class="comment">// 学历</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明变量</span></span><br><span class="line"><span class="keyword">const</span> teacher: Teacher = &#123;</span><br><span class="line">    name: <span class="string">'张三'</span>,</span><br><span class="line">    age: <span class="number">24</span>,</span><br><span class="line">    education: <span class="string">'本科'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相互继承</p>
<p>type extends interface</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface User &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// type extends interface</span></span><br><span class="line">type Teacher = User &amp; &#123;</span><br><span class="line">    education: string, <span class="comment">// 学历</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>interface extends type</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type User = &#123;</span><br><span class="line">    name: string</span><br><span class="line">    age: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface extends type</span></span><br><span class="line">interface Teacher extends User &#123;</span><br><span class="line">    education: string, <span class="comment">// 学历</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-2-不同点"><a href="#2-2-不同点" class="headerlink" title="2.2 不同点"></a>2.2 不同点</h3><ul>
<li>type 可以声明几杯类型别名、联合类型、元祖等类型</li>
<li>type语句中还可以使用typeof 获取实例的类型进行赋值</li>
</ul>
<ul>
<li>interface 能够声明合并，而type不行</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li>[1] <a href="https://blog.csdn.net/weixin_33724659/article/details/88040828" target="_blank" rel="noopener">Typescript 中的 interface 和 type 到底有什么区别</a></li>
<li>[2] <a href="https://juejin.im/post/6844904114925600776" target="_blank" rel="noopener">TypeScript 中 interface 和 type 使用区别介绍</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/07/%E5%B0%81%E8%A3%85%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%92%8CHooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/07/%E5%B0%81%E8%A3%85%E6%97%A5%E5%B8%B8%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%92%8CHooks/" itemprop="url">封装日常工具函数和Hooks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-07T10:39:35+08:00">
                2020-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hooks/" itemprop="url" rel="index">
                    <span itemprop="name">Hooks</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="封装日常工具函数和Hooks">封装日常工具函数和Hooks</h2><h3 id="概述">概述</h3><blockquote>
<p>封装日常使用的工具函数、React组件和Hooks，提高开发效率，避免踩坑</p>
</blockquote>
<h4 id="工具函数">工具函数</h4><p><strong>过滤参不合法对象属性</strong></p>
<p>清理对象参数值，过滤不合法参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清理对象参数值，过滤不合法参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> <span class="variable">params</span></span> - 待清理的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;array&#125;</span> <span class="variable">filters</span></span> - 清理的值信息，默认当值为[null, undefined, NaN, '']中的任意值时，该字段被清理掉</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;object&#125;</span> </span>清理之后的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">clearObject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  params,</span></span></span><br><span class="line"><span class="function"><span class="params">  filters = [null, undefined, NaN, <span class="string">''</span>]</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newParams = &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(params).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!filters.includes(params[key])) &#123;</span><br><span class="line">        newParams[key] = params[key]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> newParams</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>时间格式化</strong></p>
<p>格式化时间戳，支持格式化时间区间</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间格式化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;number&#125;</span> <span class="variable">start</span></span> - 开始时间戳，毫秒级</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;number&#125;</span> <span class="variable">end</span></span> - 结束时间戳，毫秒级</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> <span class="variable">config</span></span> - 格式化配置项</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">format</span></span> - 转换格式，默认格式是YYYY-MM-DD HH:mm</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">separator</span></span> - 分割字符串，默认是'-'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;string&#125;</span></span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037) ==&gt; 2019-04-09 00:00</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037) ==&gt; 2019-04-09 00:00 - 2019-04-09 00:00</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037, format = 'YYYY-MM-DD') ==&gt; 2019-04 - 09-2019-04-09</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037,  format = 'YYYY-MM-DD', separator = '/' )  ==&gt; 2019-0409/2019-04-09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatDate</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  start,</span></span></span><br><span class="line"><span class="function"><span class="params">  end,</span></span></span><br><span class="line"><span class="function"><span class="params">  format = <span class="string">'YYYY-MM-DD HH:mm'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  separator  = <span class="string">'-'</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((start &amp;&amp; !<span class="built_in">isNaN</span>(start)) &amp;&amp; (end &amp;&amp; !<span class="built_in">isNaN</span>(end))) &#123;</span><br><span class="line">    <span class="keyword">const</span> startTime = moment(start).format(format)</span><br><span class="line">    <span class="keyword">const</span> endTime = moment(end).format(format)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;startTime&#125;</span> <span class="subst">$&#123;separator&#125;</span> <span class="subst">$&#123;endTime&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (start &amp;&amp; !<span class="built_in">isNaN</span>(start)) &#123;</span><br><span class="line">    <span class="keyword">return</span> moment(start).format(format)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (end &amp;&amp; !<span class="built_in">isNaN</span>(end)) &#123;</span><br><span class="line">    <span class="keyword">return</span> moment(end).format(format)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>时间区间格式化</strong></p>
<p>格式化时间为开始时间：00:00:00 - 结束时间: 23:59:59</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间区间格式化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">date</span></span> - 时间戳（毫秒级）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;object&#125;</span></span></span></span><br><span class="line"><span class="comment"> *  start 日起开始时间: YYYY-MM-DD 00:00:00</span></span><br><span class="line"><span class="comment"> *  end 日起结束时间: YYYY-MM-DD 23:59:59</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatDateSpace(1554790648037) </span></span><br><span class="line"><span class="comment"> * ==&gt; </span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *  start: '2019-04-09 00:00:00',</span></span><br><span class="line"><span class="comment"> *  start: '2019-04-09 23:59:59' </span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatDateSpace</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (date &amp;&amp; !<span class="built_in">isNaN</span>(date)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      start: <span class="string">`<span class="subst">$&#123;moment(date).format(<span class="string">'YYYY-MM-DD'</span>)&#125;</span> 00:00:00`</span>,</span><br><span class="line">      end: <span class="string">`<span class="subst">$&#123;moment(date).format(<span class="string">'YYYY-MM-DD'</span>)&#125;</span> 23:59:59`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>匹配枚举字段值</strong></p>
<p>匹配枚举字段值，针对Table列表格式化显示的辅助工具函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 匹配枚举字段值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">key</span></span> -  某状态/类型对应的type值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;array&#125;</span> <span class="variable">source</span></span>  -  所有状态/类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">keyName</span></span> -  匹配key字段名，默认是'label'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">valueName</span></span>  -  匹配value字段名，默认是'value'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span>  </span>-  该key值对应的状态/类型，匹配失败'-'</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * const source = [</span></span><br><span class="line"><span class="comment"> *  &#123;</span></span><br><span class="line"><span class="comment"> *    label: 1</span></span><br><span class="line"><span class="comment"> *    value:'例子1'</span></span><br><span class="line"><span class="comment"> *  &#125;,&#123;</span></span><br><span class="line"><span class="comment"> *    label: 2</span></span><br><span class="line"><span class="comment"> *    value:'例子2'</span></span><br><span class="line"><span class="comment"> *  &#125;,</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> * matchRelevantValue(1, source) === '例子1'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatMatchValue</span>(<span class="params">key, source = [], keyName = <span class="string">'label'</span>, valueName = <span class="string">'value'</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> item = source.find(<span class="function"><span class="params">item</span> =&gt;</span> item[<span class="string">`<span class="subst">$&#123;keyName&#125;</span>`</span>] === key)</span><br><span class="line">  <span class="keyword">if</span> (item) &#123;</span><br><span class="line">    <span class="keyword">return</span> item[<span class="string">`<span class="subst">$&#123;valueName&#125;</span>`</span>] || <span class="string">'-'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'-'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>数字格式化为千分位</strong></p>
<p>数字格式化为千分位，主要格式化金额</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数字格式化为千分位</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">targetNumber</span></span> -  数值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">fractionDigits</span></span> -  保留小数位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatThousandsSeparator(1000) === 1,000</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatThousandsSeparator(1000,2) === 1,000.00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatThousandsSeparator</span>(<span class="params">targetNumber, fractionDigits</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!targetNumber &amp;&amp; targetNumber !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (targetNumber === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> minus = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 兼容负数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">  <span class="keyword">if</span> (targetNumber &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    minus = <span class="literal">true</span>;</span><br><span class="line">    targetNumber = <span class="built_in">Math</span>.abs(targetNumber);</span><br><span class="line">  &#125;</span><br><span class="line">  fractionDigits = fractionDigits &gt;= <span class="number">0</span> &amp;&amp; fractionDigits &lt;= <span class="number">20</span> ? fractionDigits : <span class="number">2</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * replace(/[^\d\.-]/g, '')</span></span><br><span class="line"><span class="comment">     * 匹配 除数字、逗号（,）、短横线（ - 负数符号）之外的字符串,替换成''</span></span><br><span class="line"><span class="comment">     * eq: 'a123'.replace(/[^\d\.-]/g, '') === 123</span></span><br><span class="line"><span class="comment">     * eq: 'a123bc'.replace(/[^\d\.-]/g, '0') === 012300</span></span><br><span class="line"><span class="comment">     * eq: 'a123-'.replace(/[^\d\.-]/g, '0') === 0123-</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  targetNumber = <span class="string">`<span class="subst">$&#123;<span class="built_in">parseFloat</span>((<span class="string">`<span class="subst">$&#123;targetNumber&#125;</span>`</span>).replace(<span class="regexp">/[^\d\.-]/g</span>, <span class="string">''</span>)).toFixed(fractionDigits)&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> reversedSplitNumber = targetNumber.split(<span class="string">'.'</span>)[<span class="number">0</span>].split(<span class="string">''</span>).reverse();</span><br><span class="line">  <span class="comment">// 小数位</span></span><br><span class="line">  <span class="keyword">const</span> decimalPlace = targetNumber.split(<span class="string">'.'</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> reversedString = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversedSplitNumber.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    reversedString += reversedSplitNumber[i] + ((i + <span class="number">1</span>) % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; (i + <span class="number">1</span>) !== reversedSplitNumber.length ? <span class="string">','</span> : <span class="string">''</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 兼容负数和整数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;minus ? <span class="string">'-'</span> : <span class="string">''</span>&#125;</span><span class="subst">$&#123;reversedString.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)&#125;</span><span class="subst">$&#123;decimalPlace ? <span class="string">`.<span class="subst">$&#123;decimalPlace&#125;</span>`</span> : <span class="string">''</span>&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>金额格式化转换</strong></p>
<p>金额格式化转换，针对分转元，元转分的，这里使用了 number-precision 工具包，用于金额的精准计算，避免在小数值计算时产生误差（避免踩坑）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install number-precision --save</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> NP <span class="keyword">from</span> <span class="string">'number-precision'</span></span><br><span class="line"><span class="keyword">import</span> formatThousandsSeparator <span class="keyword">from</span> <span class="string">'./formatThousandsSeparator'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 金额格式化转换</span></span><br><span class="line"><span class="comment"> *  元转分</span></span><br><span class="line"><span class="comment"> *  分转元（默认千分位格式化，并保留2位小数）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">money</span></span> - 金额(元/分)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">mode</span></span> - 模式：'toYuan'（分-&gt;元）'toCent'（元-&gt;分），默认是 'toYuan'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> </span>config 转换配置项</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> <span class="variable">thousandsSeparator</span></span> -  是否需要格式化成千分位,默认为true</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">fractionDigits</span></span>  - 保留小数位数,默认为2</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">illegalCharacter</span></span>  - 非法数据是展示的字符</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>转换之后的金额</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatCentToYuan(100000) === 1,000.00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatMoney</span>(<span class="params">money, mode = <span class="string">'toYuan'</span>, config = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; thousandsSeparator = <span class="literal">true</span>, fractionDigits = <span class="number">2</span>, illegalCharacter = <span class="string">'-'</span>&#125; = config</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!money || <span class="built_in">isNaN</span>(money)) &#123;</span><br><span class="line">    <span class="keyword">return</span> illegalCharacter</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'toYuan'</span>: &#123;</span><br><span class="line">      <span class="keyword">const</span> yuan = NP.round(NP.divide(money, <span class="number">100</span>), fractionDigits)</span><br><span class="line">      <span class="keyword">if</span> (!thousandsSeparator) &#123;</span><br><span class="line">        <span class="keyword">return</span> yuan</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> formatThousandsSeparator(yuan, fractionDigits)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'toCent'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> NP.round(NP.times(money, <span class="number">100</span>), <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> illegalCharacter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>工具包地址：<a href="https://github.com/zhaowei-plus/utils-tools" target="_blank" rel="noopener">https://github.com/zhaowei-plus/utils-tools</a></p>
<h4 id="组件">组件</h4><p><strong>列表搜索组件</strong></p>
<p>List表头搜索组件，一般是和Antd Table配合使用，这里使用了Formily表单库，在使用前需要安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @formily&#x2F;antd</span><br><span class="line">npm install --save @formily&#x2F;antd-components &#x2F;*扩展库*&#x2F;</span><br></pre></td></tr></table></figure>
<p>Formily官网地址：<a href="https://formilyjs.org/#/bdCRC5/dzUZU8il" target="_blank" rel="noopener">https://formilyjs.org/#/bdCRC5/dzUZU8il</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;</span><br><span class="line">import &#123;</span><br><span class="line">  SchemaForm,</span><br><span class="line">  FormButtonGroup,</span><br><span class="line">  Submit,</span><br><span class="line">  Reset</span><br><span class="line">&#125; from &#39;@formily&#x2F;antd&#39;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  formatPlaceholder,</span><br><span class="line">  clearObject</span><br><span class="line">&#125; from &#39;..&#x2F;Utils&#39;</span><br><span class="line"></span><br><span class="line">import &#39;.&#x2F;index.less&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 格式化schema中的placeholder提示信息</span><br><span class="line"> *&#x2F;</span><br><span class="line">export const formatPlaceholder &#x3D; (schema) &#x3D;&gt; &#123;</span><br><span class="line">  Object.keys(schema).forEach(key &#x3D;&gt; &#123;</span><br><span class="line">    if (schema[key].type &#x3D;&#x3D;&#x3D; &#39;string&#39;) &#123;</span><br><span class="line">      const item &#x3D; schema[key]</span><br><span class="line">      if (!Reflect.has(item, &#39;x-props&#39;)) &#123;</span><br><span class="line">        item[&#39;x-props&#39;] &#x3D; &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (Array.isArray(item.enum)) &#123;</span><br><span class="line">        item[&#39;x-props&#39;].placeholder &#x3D; &#39;请选择&#39;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        item[&#39;x-props&#39;].placeholder &#x3D; &#39;请输入&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  return schema</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default (props) &#x3D;&gt; &#123;</span><br><span class="line">  const &#123;schema, onSearch, ...rest&#125; &#x3D; props</span><br><span class="line"></span><br><span class="line">  const onSubmit &#x3D; (params) &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; clearObject 过滤空值的属性</span><br><span class="line">    onSearch(clearObject(params))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;SchemaForm</span><br><span class="line">      schema&#x3D;&#123;&#123;</span><br><span class="line">        type: &#39;object&#39;,</span><br><span class="line">        properties: formatPlaceholder(schema)</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      onSubmit&#x3D;&#123;onSubmit&#125;</span><br><span class="line">      onReset&#x3D;&#123;onSubmit&#125;</span><br><span class="line">      className&#x3D;&quot;search&quot;</span><br><span class="line">      &#123;...rest&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;FormButtonGroup className&#x3D;&quot;search__actions&quot;&gt;</span><br><span class="line">        &lt;Submit&gt;查询&lt;&#x2F;Submit&gt;</span><br><span class="line">        &lt;Reset&gt;重置&lt;&#x2F;Reset&gt;</span><br><span class="line">      &lt;&#x2F;FormButtonGroup&gt;</span><br><span class="line">    &lt;&#x2F;SchemaForm&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>css 样式如下：<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.ant-form-item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: minmax(<span class="number">80px</span>, max-content) auto;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.ant-form-item-label</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.ant-form-item-control-wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.ant-calendar-picker</span>,</span><br><span class="line">      <span class="selector-class">.ant-select</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">min-width</span>: <span class="number">200px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;__actions &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.button-group</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">140px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>注意Search组件中的schema是Formily的标准schema（<a href="https://formilyjs.org/#/0yTeT0/jAU8UVSYI8" target="_blank" rel="noopener">Formily Form Schema文档地址</a>）去掉了外部的 properties 配置：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">    <span class="string">"properties"</span>: &#123;</span><br><span class="line">        ...schema <span class="comment">// 导入的schema配置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>案例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> schema = &#123;</span><br><span class="line">        orgName: &#123;</span><br><span class="line">          type: <span class="string">'string'</span>,</span><br><span class="line">          title: <span class="string">'企业名称/编码'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">// 根据条件搜索数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Search</span><br><span class="line">            schema=&#123;schema&#125;</span><br><span class="line">            onSearch=&#123;onSearch&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>显示结果：</p>
<p><img src="https://global.uban360.com/sfs/file?digest=fid71f681723a774999d7f9d32642014b2d&amp;fileType=2" alt=""></p>
<h4 id="Hooks">Hooks</h4><p><strong>useList</strong></p>
<p>useList hook是组装了表头搜索组件和Table结果数据的hook，通过url和默认参数搜索结果，获取Table数据并显示，具体代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useList hook，用于Table、有搜索栏的Table数据搜索</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>initialParams 初始化参数，初始化时需要有搜索参数，并且在后续搜索中可以被修改的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>staticParams 静态参数，每次搜索都固定不变的参数</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [params, setParams] = useState(initialParams)</span><br><span class="line">  <span class="keyword">const</span> [dataSource, setDataSource] = useState([])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [pagination, setPagination] = useState(&#123;</span><br><span class="line">    current: <span class="number">1</span>,</span><br><span class="line">    pageSize: <span class="number">10</span>,</span><br><span class="line">    total: <span class="number">0</span>,</span><br><span class="line">    showQuickJumper: <span class="literal">true</span>,</span><br><span class="line">    showTotal: <span class="function"><span class="params">total</span> =&gt;</span> <span class="string">`共<span class="subst">$&#123;total&#125;</span>条`</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 查询列表信息：</span></span><br><span class="line"><span class="comment">   *  1 刷新时，分页器不变，搜索参数不变</span></span><br><span class="line"><span class="comment">   *  2 查询时，分页器清零，搜索参数改变</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onFetch = <span class="function">(<span class="params">_pagination = pagination, _params = params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">current</span>: currentPage, pageSize &#125; = _pagination</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      pageIndex: currentPage,</span><br><span class="line">      pageNo: currentPage,</span><br><span class="line">      pageSize,</span><br><span class="line">      ..._params,</span><br><span class="line">      ...staticParams</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向后端发送请求列表数据的方法根据项目实际自定义实现，主要</span></span><br><span class="line"><span class="comment">     * 是针对不同项目请求方式的不同做兼容处理</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     * 注意：这里的请求没有写死，主要是因为很多项目中的请求方式不一样，使用时可以拷贝自行替换</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    http.get(url, &#123;</span><br><span class="line">      pageIndex: currentPage,</span><br><span class="line">      pageNo: currentPage,</span><br><span class="line">      pageSize,</span><br><span class="line">      ..._params,</span><br><span class="line">      ...staticParams</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; rows = [], total &#125; = res.data || &#123;&#125;</span><br><span class="line">      setDataSource(rows)</span><br><span class="line">      setParams(_params)</span><br><span class="line">      setPagination(&#123;</span><br><span class="line">        ..._pagination,</span><br><span class="line">        total,</span><br><span class="line">        current: currentPage</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 参数查询列表信息</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">_params</span>) =&gt;</span> &#123;</span><br><span class="line">    onFetch(&#123; ...pagination,  <span class="attr">current</span>: <span class="number">1</span>&#125;, _params)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 分页查询列表信息</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function">(<span class="params">_pagination</span>) =&gt;</span> &#123;</span><br><span class="line">    onFetch(_pagination)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    params,</span><br><span class="line">    onSearch,</span><br><span class="line">    onFetch,</span><br><span class="line">    <span class="comment">// table所需要的值</span></span><br><span class="line">    table: &#123;</span><br><span class="line">      pagination,</span><br><span class="line">      dataSource,</span><br><span class="line">      onChange,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>案例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = useList(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      list.onSearch(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      list.onFetch() <span class="comment">// 搜索数据</span></span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 list.params</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;Table</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        &#123;...list.table&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>useTable</strong></p>
<p>useTable 是基于useList 的简单封装，返回Table数据和XmTable组件，不需要导入Antd的Table，代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Table&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useList <span class="keyword">from</span> <span class="string">'./use-list'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = useList(url, initialParams, staticParams)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> XmTable = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; rowKey = <span class="string">'id'</span>, columns = [], ...rest &#125; = props</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>  (</span><br><span class="line">      &lt;Table</span><br><span class="line">        rowKey=&#123;rowKey&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        &#123;...list.table&#125;</span><br><span class="line">        &#123;...rest&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    table: list,</span><br><span class="line">    XmTable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>案例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; table, XmTable &#125; = useTable(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      table.onSearch(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      table.onFetch() <span class="comment">// 搜索数据</span></span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 table.params</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;XmTable</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>useSearchTable</strong><br>useSearchTable 是基于封装了Search组件和useTablehook,返回Table数据和SearchTable组件，代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useState, Fragment, useEffect&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useTable <span class="keyword">from</span> <span class="string">'./use-table'</span></span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">"../Search"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [ initialValues, setInitialValues ] = useState(initialParams)</span><br><span class="line">  <span class="keyword">const</span> &#123; table, XmTable &#125; = useTable(url, initialParams, staticParams)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> SearchTable = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; schema, columns = [], onSearch, ...rest &#125; = props</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> handleSearch = <span class="function">(<span class="params">params = initialParams</span>) =&gt;</span> &#123;</span><br><span class="line">      setInitialValues(params)</span><br><span class="line">      table.onSearch(<span class="keyword">typeof</span> onSearch === <span class="string">'function'</span> ? onSearch(params) : params)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Fragment&gt;</span><br><span class="line">        &lt;div className=<span class="string">"app-page__card"</span>&gt;</span><br><span class="line">          &lt;Search</span><br><span class="line">            schema=&#123;schema&#125;</span><br><span class="line">            onSearch=&#123;handleSearch&#125;</span><br><span class="line">            initialValues=&#123;initialValues&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="app-page__card"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;XmTable</span></span><br><span class="line"><span class="regexp">            columns=&#123;columns&#125;</span></span><br><span class="line"><span class="regexp">            &#123;...rest&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    table.onSearch(initialParams)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    table,</span><br><span class="line">    SearchTable,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>案例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; table, SearchTable &#125; = useSearchTable(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 table.params</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> schema = &#123; <span class="comment">/** Search搜索项 **/</span> &#125;</span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SearchTable</span><br><span class="line">        schema=&#123;schema&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>useVisible</strong><br>useVisible 是对Antd Modal封装的hook，可以更方便的open/close，代码如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 hook：用于弹出框的打开与关闭控制</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> </span>initVisible 初始化modal的显示状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (initVisible = <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [params, setParams] = useState()</span><br><span class="line">  <span class="keyword">const</span> [visible, setVisible] = useState(initVisible)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> open = useCallback(<span class="function">(<span class="params">_params</span>) =&gt;</span> &#123;</span><br><span class="line">    setParams(_params)</span><br><span class="line">    setVisible(<span class="literal">true</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> close = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setParams()</span><br><span class="line">    setVisible(<span class="literal">false</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    params,</span><br><span class="line">    visible,</span><br><span class="line">    open,</span><br><span class="line">    close,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>案例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> editModal = useVisible()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> opem = <span class="function">(<span class="params">orderId</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// open 传递的参数</span></span><br><span class="line">      editModal.open(orderId)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  &#123;</span><br><span class="line">        editModal.visible &amp;&amp; (</span><br><span class="line">          &lt;EditModal</span><br><span class="line">            orderId=&#123;editModal.params&#125;</span><br><span class="line">            onCancel=&#123;editModal.close&#125;</span><br><span class="line">            onOk=&#123;() =&gt; &#123;</span><br><span class="line">              editModal.close()</span><br><span class="line">              table.onFetch()</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Hooks包地址：<a href="https://github.com/zhaowei-plus/utils-hooks" target="_blank" rel="noopener">https://github.com/zhaowei-plus/utils-hooks</a></p>
<h4 id="其他">其他</h4><p>更多自定义Hooks可以查看<a href="https://hooks.umijs.org/zh-CN/hooks/async" target="_blank" rel="noopener">umijs Hooks封装</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/07/Js%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/07/Js%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1/" itemprop="url">封装日常工具函数和Hooks</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-07T10:39:35+08:00">
                2020-04-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hooks/" itemprop="url" rel="index">
                    <span itemprop="name">Hooks</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="封装日常工具函数和Hooks"><a href="#封装日常工具函数和Hooks" class="headerlink" title="封装日常工具函数和Hooks"></a>封装日常工具函数和Hooks</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>封装日常使用的工具函数、React组件和Hooks，提高开发效率，避免踩坑</p>
</blockquote>
<h4 id="工具函数"><a href="#工具函数" class="headerlink" title="工具函数"></a>工具函数</h4><p><strong>过滤参不合法对象属性</strong></p>
<p>清理对象参数值，过滤不合法参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清理对象参数值，过滤不合法参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> <span class="variable">params</span></span> - 待清理的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;array&#125;</span> <span class="variable">filters</span></span> - 清理的值信息，默认当值为[null, undefined, NaN, '']中的任意值时，该字段被清理掉</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;object&#125;</span> </span>清理之后的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">clearObject</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  params,</span></span></span><br><span class="line"><span class="function"><span class="params">  filters = [null, undefined, NaN, <span class="string">''</span>]</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (params <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newParams = &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(params).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!filters.includes(params[key])) &#123;</span><br><span class="line">        newParams[key] = params[key]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> newParams</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>时间格式化</strong></p>
<p>格式化时间戳，支持格式化时间区间</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间格式化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;number&#125;</span> <span class="variable">start</span></span> - 开始时间戳，毫秒级</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;number&#125;</span> <span class="variable">end</span></span> - 结束时间戳，毫秒级</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> <span class="variable">config</span></span> - 格式化配置项</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">format</span></span> - 转换格式，默认格式是YYYY-MM-DD HH:mm</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">separator</span></span> - 分割字符串，默认是'-'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;string&#125;</span></span></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037) ==&gt; 2019-04-09 00:00</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037) ==&gt; 2019-04-09 00:00 - 2019-04-09 00:00</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037, format = 'YYYY-MM-DD') ==&gt; 2019-04 - 09-2019-04-09</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * fixDateRequestParams(1554790648037, 1554790648037,  format = 'YYYY-MM-DD', separator = '/' )  ==&gt; 2019-0409/2019-04-09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatDate</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  start,</span></span></span><br><span class="line"><span class="function"><span class="params">  end,</span></span></span><br><span class="line"><span class="function"><span class="params">  format = <span class="string">'YYYY-MM-DD HH:mm'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  separator  = <span class="string">'-'</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((start &amp;&amp; !<span class="built_in">isNaN</span>(start)) &amp;&amp; (end &amp;&amp; !<span class="built_in">isNaN</span>(end))) &#123;</span><br><span class="line">    <span class="keyword">const</span> startTime = moment(start).format(format)</span><br><span class="line">    <span class="keyword">const</span> endTime = moment(end).format(format)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;startTime&#125;</span> <span class="subst">$&#123;separator&#125;</span> <span class="subst">$&#123;endTime&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (start &amp;&amp; !<span class="built_in">isNaN</span>(start)) &#123;</span><br><span class="line">    <span class="keyword">return</span> moment(start).format(format)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (end &amp;&amp; !<span class="built_in">isNaN</span>(end)) &#123;</span><br><span class="line">    <span class="keyword">return</span> moment(end).format(format)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>时间区间格式化</strong></p>
<p>格式化时间为开始时间：00:00:00 - 结束时间: 23:59:59</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 时间区间格式化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">date</span></span> - 时间戳（毫秒级）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;object&#125;</span></span></span></span><br><span class="line"><span class="comment"> *  start 日起开始时间: YYYY-MM-DD 00:00:00</span></span><br><span class="line"><span class="comment"> *  end 日起结束时间: YYYY-MM-DD 23:59:59</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatDateSpace(1554790648037) </span></span><br><span class="line"><span class="comment"> * ==&gt; </span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *  start: '2019-04-09 00:00:00',</span></span><br><span class="line"><span class="comment"> *  start: '2019-04-09 23:59:59' </span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatDateSpace</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (date &amp;&amp; !<span class="built_in">isNaN</span>(date)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      start: <span class="string">`<span class="subst">$&#123;moment(date).format(<span class="string">'YYYY-MM-DD'</span>)&#125;</span> 00:00:00`</span>,</span><br><span class="line">      end: <span class="string">`<span class="subst">$&#123;moment(date).format(<span class="string">'YYYY-MM-DD'</span>)&#125;</span> 23:59:59`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>匹配枚举字段值</strong></p>
<p>匹配枚举字段值，针对Table列表格式化显示的辅助工具函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 匹配枚举字段值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">key</span></span> -  某状态/类型对应的type值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;array&#125;</span> <span class="variable">source</span></span>  -  所有状态/类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">keyName</span></span> -  匹配key字段名，默认是'label'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">valueName</span></span>  -  匹配value字段名，默认是'value'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;string&#125;</span>  </span>-  该key值对应的状态/类型，匹配失败'-'</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * const source = [</span></span><br><span class="line"><span class="comment"> *  &#123;</span></span><br><span class="line"><span class="comment"> *    label: 1</span></span><br><span class="line"><span class="comment"> *    value:'例子1'</span></span><br><span class="line"><span class="comment"> *  &#125;,&#123;</span></span><br><span class="line"><span class="comment"> *    label: 2</span></span><br><span class="line"><span class="comment"> *    value:'例子2'</span></span><br><span class="line"><span class="comment"> *  &#125;,</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> * matchRelevantValue(1, source) === '例子1'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatMatchValue</span>(<span class="params">key, source = [], keyName = <span class="string">'label'</span>, valueName = <span class="string">'value'</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> item = source.find(<span class="function"><span class="params">item</span> =&gt;</span> item[<span class="string">`<span class="subst">$&#123;keyName&#125;</span>`</span>] === key)</span><br><span class="line">  <span class="keyword">if</span> (item) &#123;</span><br><span class="line">    <span class="keyword">return</span> item[<span class="string">`<span class="subst">$&#123;valueName&#125;</span>`</span>] || <span class="string">'-'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'-'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数字格式化为千分位</strong></p>
<p>数字格式化为千分位，主要格式化金额</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数字格式化为千分位</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">targetNumber</span></span> -  数值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">fractionDigits</span></span> -  保留小数位数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatThousandsSeparator(1000) === 1,000</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatThousandsSeparator(1000,2) === 1,000.00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatThousandsSeparator</span>(<span class="params">targetNumber, fractionDigits</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!targetNumber &amp;&amp; targetNumber !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (targetNumber === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> minus = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 兼容负数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">  <span class="keyword">if</span> (targetNumber &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    minus = <span class="literal">true</span>;</span><br><span class="line">    targetNumber = <span class="built_in">Math</span>.abs(targetNumber);</span><br><span class="line">  &#125;</span><br><span class="line">  fractionDigits = fractionDigits &gt;= <span class="number">0</span> &amp;&amp; fractionDigits &lt;= <span class="number">20</span> ? fractionDigits : <span class="number">2</span>;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * replace(/[^\d\.-]/g, '')</span></span><br><span class="line"><span class="comment">     * 匹配 除数字、逗号（,）、短横线（ - 负数符号）之外的字符串,替换成''</span></span><br><span class="line"><span class="comment">     * eq: 'a123'.replace(/[^\d\.-]/g, '') === 123</span></span><br><span class="line"><span class="comment">     * eq: 'a123bc'.replace(/[^\d\.-]/g, '0') === 012300</span></span><br><span class="line"><span class="comment">     * eq: 'a123-'.replace(/[^\d\.-]/g, '0') === 0123-</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  targetNumber = <span class="string">`<span class="subst">$&#123;<span class="built_in">parseFloat</span>((<span class="string">`<span class="subst">$&#123;targetNumber&#125;</span>`</span>).replace(<span class="regexp">/[^\d\.-]/g</span>, <span class="string">''</span>)).toFixed(fractionDigits)&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> reversedSplitNumber = targetNumber.split(<span class="string">'.'</span>)[<span class="number">0</span>].split(<span class="string">''</span>).reverse();</span><br><span class="line">  <span class="comment">// 小数位</span></span><br><span class="line">  <span class="keyword">const</span> decimalPlace = targetNumber.split(<span class="string">'.'</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">let</span> reversedString = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversedSplitNumber.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    reversedString += reversedSplitNumber[i] + ((i + <span class="number">1</span>) % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; (i + <span class="number">1</span>) !== reversedSplitNumber.length ? <span class="string">','</span> : <span class="string">''</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 兼容负数和整数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;minus ? <span class="string">'-'</span> : <span class="string">''</span>&#125;</span><span class="subst">$&#123;reversedString.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)&#125;</span><span class="subst">$&#123;decimalPlace ? <span class="string">`.<span class="subst">$&#123;decimalPlace&#125;</span>`</span> : <span class="string">''</span>&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>金额格式化转换</strong></p>
<p>金额格式化转换，针对分转元，元转分的，这里使用了 number-precision 工具包，用于金额的精准计算，避免在小数值计算时产生误差（避免踩坑）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install number-precision --save</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> NP <span class="keyword">from</span> <span class="string">'number-precision'</span></span><br><span class="line"><span class="keyword">import</span> formatThousandsSeparator <span class="keyword">from</span> <span class="string">'./formatThousandsSeparator'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 金额格式化转换</span></span><br><span class="line"><span class="comment"> *  元转分</span></span><br><span class="line"><span class="comment"> *  分转元（默认千分位格式化，并保留2位小数）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">money</span></span> - 金额(元/分)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">mode</span></span> - 模式：'toYuan'（分-&gt;元）'toCent'（元-&gt;分），默认是 'toYuan'</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params <span class="type">&#123;object&#125;</span> </span>config 转换配置项</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> <span class="variable">thousandsSeparator</span></span> -  是否需要格式化成千分位,默认为true</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">fractionDigits</span></span>  - 保留小数位数,默认为2</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">illegalCharacter</span></span>  - 非法数据是展示的字符</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span> </span>转换之后的金额</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> * formatCentToYuan(100000) === 1,000.00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">formatMoney</span>(<span class="params">money, mode = <span class="string">'toYuan'</span>, config = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; thousandsSeparator = <span class="literal">true</span>, fractionDigits = <span class="number">2</span>, illegalCharacter = <span class="string">'-'</span>&#125; = config</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!money || <span class="built_in">isNaN</span>(money)) &#123;</span><br><span class="line">    <span class="keyword">return</span> illegalCharacter</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (mode) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'toYuan'</span>: &#123;</span><br><span class="line">      <span class="keyword">const</span> yuan = NP.round(NP.divide(money, <span class="number">100</span>), fractionDigits)</span><br><span class="line">      <span class="keyword">if</span> (!thousandsSeparator) &#123;</span><br><span class="line">        <span class="keyword">return</span> yuan</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> formatThousandsSeparator(yuan, fractionDigits)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'toCent'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> NP.round(NP.times(money, <span class="number">100</span>), <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> illegalCharacter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>工具包地址：<a href="https://github.com/zhaowei-plus/utils-tools" target="_blank" rel="noopener">https://github.com/zhaowei-plus/utils-tools</a></p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p><strong>列表搜索组件</strong></p>
<p>List表头搜索组件，一般是和Antd Table配合使用，这里使用了Formily表单库，在使用前需要安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @formily&#x2F;antd</span><br><span class="line">npm install --save @formily&#x2F;antd-components &#x2F;*扩展库*&#x2F;</span><br></pre></td></tr></table></figure>

<p>Formily官网地址：<a href="https://formilyjs.org/#/bdCRC5/dzUZU8il" target="_blank" rel="noopener">https://formilyjs.org/#/bdCRC5/dzUZU8il</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;</span><br><span class="line">import &#123;</span><br><span class="line">  SchemaForm,</span><br><span class="line">  FormButtonGroup,</span><br><span class="line">  Submit,</span><br><span class="line">  Reset</span><br><span class="line">&#125; from &#39;@formily&#x2F;antd&#39;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  formatPlaceholder,</span><br><span class="line">  clearObject</span><br><span class="line">&#125; from &#39;..&#x2F;Utils&#39;</span><br><span class="line"></span><br><span class="line">import &#39;.&#x2F;index.less&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 格式化schema中的placeholder提示信息</span><br><span class="line"> *&#x2F;</span><br><span class="line">export const formatPlaceholder &#x3D; (schema) &#x3D;&gt; &#123;</span><br><span class="line">  Object.keys(schema).forEach(key &#x3D;&gt; &#123;</span><br><span class="line">    if (schema[key].type &#x3D;&#x3D;&#x3D; &#39;string&#39;) &#123;</span><br><span class="line">      const item &#x3D; schema[key]</span><br><span class="line">      if (!Reflect.has(item, &#39;x-props&#39;)) &#123;</span><br><span class="line">        item[&#39;x-props&#39;] &#x3D; &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (Array.isArray(item.enum)) &#123;</span><br><span class="line">        item[&#39;x-props&#39;].placeholder &#x3D; &#39;请选择&#39;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        item[&#39;x-props&#39;].placeholder &#x3D; &#39;请输入&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  return schema</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default (props) &#x3D;&gt; &#123;</span><br><span class="line">  const &#123;schema, onSearch, ...rest&#125; &#x3D; props</span><br><span class="line"></span><br><span class="line">  const onSubmit &#x3D; (params) &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; clearObject 过滤空值的属性</span><br><span class="line">    onSearch(clearObject(params))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;SchemaForm</span><br><span class="line">      schema&#x3D;&#123;&#123;</span><br><span class="line">        type: &#39;object&#39;,</span><br><span class="line">        properties: formatPlaceholder(schema)</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      onSubmit&#x3D;&#123;onSubmit&#125;</span><br><span class="line">      onReset&#x3D;&#123;onSubmit&#125;</span><br><span class="line">      className&#x3D;&quot;search&quot;</span><br><span class="line">      &#123;...rest&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;FormButtonGroup className&#x3D;&quot;search__actions&quot;&gt;</span><br><span class="line">        &lt;Submit&gt;查询&lt;&#x2F;Submit&gt;</span><br><span class="line">        &lt;Reset&gt;重置&lt;&#x2F;Reset&gt;</span><br><span class="line">      &lt;&#x2F;FormButtonGroup&gt;</span><br><span class="line">    &lt;&#x2F;SchemaForm&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>css 样式如下：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.ant-form-item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    grid-template-<span class="attribute">columns</span>: minmax(<span class="number">80px</span>, max-content) auto;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.ant-form-item-label</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.ant-form-item-control-wrapper</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.ant-calendar-picker</span>,</span><br><span class="line">      <span class="selector-class">.ant-select</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">min-width</span>: <span class="number">200px</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;__actions &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.button-group</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">140px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意Search组件中的schema是Formily的标准schema（<a href="https://formilyjs.org/#/0yTeT0/jAU8UVSYI8" target="_blank" rel="noopener">Formily Form Schema文档地址</a>）去掉了外部的 properties 配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">    <span class="string">"properties"</span>: &#123;</span><br><span class="line">        ...schema <span class="comment">// 导入的schema配置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> schema = &#123;</span><br><span class="line">        orgName: &#123;</span><br><span class="line">          type: <span class="string">'string'</span>,</span><br><span class="line">          title: <span class="string">'企业名称/编码'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">// 根据条件搜索数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Search</span><br><span class="line">            schema=&#123;schema&#125;</span><br><span class="line">            onSearch=&#123;onSearch&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显示结果：</p>
<p><img src="https://global.uban360.com/sfs/file?digest=fid71f681723a774999d7f9d32642014b2d&fileType=2" alt=""></p>
<h4 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h4><p><strong>useList</strong></p>
<p>useList hook是组装了表头搜索组件和Table结果数据的hook，通过url和默认参数搜索结果，获取Table数据并显示，具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * useList hook，用于Table、有搜索栏的Table数据搜索</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>initialParams 初始化参数，初始化时需要有搜索参数，并且在后续搜索中可以被修改的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;object&#125;</span> </span>staticParams 静态参数，每次搜索都固定不变的参数</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [params, setParams] = useState(initialParams)</span><br><span class="line">  <span class="keyword">const</span> [dataSource, setDataSource] = useState([])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [pagination, setPagination] = useState(&#123;</span><br><span class="line">    current: <span class="number">1</span>,</span><br><span class="line">    pageSize: <span class="number">10</span>,</span><br><span class="line">    total: <span class="number">0</span>,</span><br><span class="line">    showQuickJumper: <span class="literal">true</span>,</span><br><span class="line">    showTotal: <span class="function"><span class="params">total</span> =&gt;</span> <span class="string">`共<span class="subst">$&#123;total&#125;</span>条`</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * 查询列表信息：</span></span><br><span class="line"><span class="comment">   *  1 刷新时，分页器不变，搜索参数不变</span></span><br><span class="line"><span class="comment">   *  2 查询时，分页器清零，搜索参数改变</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onFetch = <span class="function">(<span class="params">_pagination = pagination, _params = params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">current</span>: currentPage, pageSize &#125; = _pagination</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      pageIndex: currentPage,</span><br><span class="line">      pageNo: currentPage,</span><br><span class="line">      pageSize,</span><br><span class="line">      ..._params,</span><br><span class="line">      ...staticParams</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向后端发送请求列表数据的方法根据项目实际自定义实现，主要</span></span><br><span class="line"><span class="comment">     * 是针对不同项目请求方式的不同做兼容处理</span></span><br><span class="line"><span class="comment">     </span></span><br><span class="line"><span class="comment">     * 注意：这里的请求没有写死，主要是因为很多项目中的请求方式不一样，使用时可以拷贝自行替换</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    http.get(url, &#123;</span><br><span class="line">      pageIndex: currentPage,</span><br><span class="line">      pageNo: currentPage,</span><br><span class="line">      pageSize,</span><br><span class="line">      ..._params,</span><br><span class="line">      ...staticParams</span><br><span class="line">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; rows = [], total &#125; = res.data || &#123;&#125;</span><br><span class="line">      setDataSource(rows)</span><br><span class="line">      setParams(_params)</span><br><span class="line">      setPagination(&#123;</span><br><span class="line">        ..._pagination,</span><br><span class="line">        total,</span><br><span class="line">        current: currentPage</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 参数查询列表信息</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">_params</span>) =&gt;</span> &#123;</span><br><span class="line">    onFetch(&#123; ...pagination,  <span class="attr">current</span>: <span class="number">1</span>&#125;, _params)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 分页查询列表信息</span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function">(<span class="params">_pagination</span>) =&gt;</span> &#123;</span><br><span class="line">    onFetch(_pagination)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    params,</span><br><span class="line">    onSearch,</span><br><span class="line">    onFetch,</span><br><span class="line">    <span class="comment">// table所需要的值</span></span><br><span class="line">    table: &#123;</span><br><span class="line">      pagination,</span><br><span class="line">      dataSource,</span><br><span class="line">      onChange,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = useList(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      list.onSearch(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      list.onFetch() <span class="comment">// 搜索数据</span></span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 list.params</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;Table</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        &#123;...list.table&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>useTable</strong></p>
<p>useTable 是基于useList 的简单封装，返回Table数据和XmTable组件，不需要导入Antd的Table，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Table&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useList <span class="keyword">from</span> <span class="string">'./use-list'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> list = useList(url, initialParams, staticParams)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> XmTable = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; rowKey = <span class="string">'id'</span>, columns = [], ...rest &#125; = props</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>  (</span><br><span class="line">      &lt;Table</span><br><span class="line">        rowKey=&#123;rowKey&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        &#123;...list.table&#125;</span><br><span class="line">        &#123;...rest&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    table: list,</span><br><span class="line">    XmTable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; table, XmTable &#125; = useTable(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> onSearch = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      table.onSearch(params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      table.onFetch() <span class="comment">// 搜索数据</span></span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 table.params</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;XmTable</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>useSearchTable</strong><br>useSearchTable 是基于封装了Search组件和useTablehook,返回Table数据和SearchTable组件，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useState, Fragment, useEffect&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useTable <span class="keyword">from</span> <span class="string">'./use-table'</span></span><br><span class="line"><span class="keyword">import</span> Search <span class="keyword">from</span> <span class="string">"../Search"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url, initialParams = &#123;&#125;, staticParams = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [ initialValues, setInitialValues ] = useState(initialParams)</span><br><span class="line">  <span class="keyword">const</span> &#123; table, XmTable &#125; = useTable(url, initialParams, staticParams)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> SearchTable = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; schema, columns = [], onSearch, ...rest &#125; = props</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> handleSearch = <span class="function">(<span class="params">params = initialParams</span>) =&gt;</span> &#123;</span><br><span class="line">      setInitialValues(params)</span><br><span class="line">      table.onSearch(<span class="keyword">typeof</span> onSearch === <span class="string">'function'</span> ? onSearch(params) : params)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Fragment&gt;</span><br><span class="line">        &lt;div className=<span class="string">"app-page__card"</span>&gt;</span><br><span class="line">          &lt;Search</span><br><span class="line">            schema=&#123;schema&#125;</span><br><span class="line">            onSearch=&#123;handleSearch&#125;</span><br><span class="line">            initialValues=&#123;initialValues&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="app-page__card"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;XmTable</span></span><br><span class="line"><span class="regexp">            columns=&#123;columns&#125;</span></span><br><span class="line"><span class="regexp">            &#123;...rest&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    table.onSearch(initialParams)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    table,</span><br><span class="line">    SearchTable,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; table, SearchTable &#125; = useSearchTable(<span class="string">'serviceOrder/list'</span>)</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 有时候需要列表搜索的参数，可以取值 table.params</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> schema = &#123; <span class="comment">/** Search搜索项 **/</span> &#125;</span><br><span class="line">  <span class="keyword">const</span> columns = [<span class="comment">/** Table列表项 **/</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;SearchTable</span><br><span class="line">        schema=&#123;schema&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>useVisible</strong><br>useVisible 是对Antd Modal封装的hook，可以更方便的open/close，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义 hook：用于弹出框的打开与关闭控制</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;boolean&#125;</span> </span>initVisible 初始化modal的显示状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (initVisible = <span class="literal">false</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [params, setParams] = useState()</span><br><span class="line">  <span class="keyword">const</span> [visible, setVisible] = useState(initVisible)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> open = useCallback(<span class="function">(<span class="params">_params</span>) =&gt;</span> &#123;</span><br><span class="line">    setParams(_params)</span><br><span class="line">    setVisible(<span class="literal">true</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> close = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setParams()</span><br><span class="line">    setVisible(<span class="literal">false</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    params,</span><br><span class="line">    visible,</span><br><span class="line">    open,</span><br><span class="line">    close,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>案例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">() =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> editModal = useVisible()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> opem = <span class="function">(<span class="params">orderId</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// open 传递的参数</span></span><br><span class="line">      editModal.open(orderId)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  &#123;</span><br><span class="line">        editModal.visible &amp;&amp; (</span><br><span class="line">          &lt;EditModal</span><br><span class="line">            orderId=&#123;editModal.params&#125;</span><br><span class="line">            onCancel=&#123;editModal.close&#125;</span><br><span class="line">            onOk=&#123;() =&gt; &#123;</span><br><span class="line">              editModal.close()</span><br><span class="line">              table.onFetch()</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Hooks包地址：<a href="https://github.com/zhaowei-plus/utils-hooks" target="_blank" rel="noopener">https://github.com/zhaowei-plus/utils-hooks</a></p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>更多自定义Hooks可以查看<a href="https://hooks.umijs.org/zh-CN/hooks/async" target="_blank" rel="noopener">umijs Hooks封装</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/12/Formily%E5%85%A5%E9%97%A8%E5%92%8C%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/12/Formily%E5%85%A5%E9%97%A8%E5%92%8C%E4%BD%BF%E7%94%A8/" itemprop="url">Formily入门和使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-12T10:39:35+08:00">
                2019-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rxjs/" itemprop="url" rel="index">
                    <span itemprop="name">Rxjs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>by zhaowei 2019/12/19</p>
</blockquote>
<p>[TOC]</p>
<h2 id="概述">概述</h2><blockquote>
<p> Formily是面向中后台复杂业务场景的高性能表单解决方案，具有强大的JSON Schema数据驱动的动态表单渲染能力，解决动态渲染表单场景，支持各种复杂联动、复杂校验等业务逻辑。</p>
</blockquote>
<h2 id="解决方案">解决方案</h2><p>Formily是Uform更名而来，所以多数基础案例可以查看Ufrom1.x版本的官网链接，里面有很多详细的使用案例。</p>
<p><a href="https://uformjs.org/#/MpI2Ij/dNFzFyTb" target="_blank" rel="noopener">https://uform-next.netlify.com (1.x)</a>，该版本中包含大量Formily使用案例，可以快速参考</p>
<p><a href="https://formilyjs.org/#/bdCRC5/BlUJUaiw" target="_blank" rel="noopener">https://formilyjs.org/#/bdCRC5/BlUJUaiw</a>，新版本的地址，Formily的使用方法改变不大，新增加了更多的说明文档和扩展案例，对新增加的功能有更详细的说明。</p>
<h3 id="表单定义">表单定义</h3><p>Formily具有强大的Schema解析能力，对于表单定义有Jsx描述、Json Schema描述方式，目前这两种方式不能混用</p>
<p><strong>Jsx定义表单</strong></p>
<p>Jsx描述是依赖Field组件用于定义表单项信息，当表单项比较多时，代码会比较多。</p>
<p>Field形式如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;SchemaForm&gt;</span><br><span class="line">    &lt;Field type=<span class="string">"Object"</span> name=<span class="string">"aaa"</span>&gt;</span><br><span class="line">       &lt;Field type=<span class="string">"string"</span> name=<span class="string">"bbb"</span>/&gt;</span><br><span class="line">       &lt;Field type=<span class="string">"array"</span> name=<span class="string">"ccc"</span>&gt;</span><br><span class="line">          &lt;Field type=<span class="string">"object"</span>&gt;</span><br><span class="line">              &lt;Field type=<span class="string">"string"</span> name=<span class="string">"ddd"</span>/&gt;</span><br><span class="line">           &lt;<span class="regexp">/Field&gt; </span></span><br><span class="line"><span class="regexp">       &lt;/</span>Field&gt;</span><br><span class="line">    &lt;<span class="regexp">/Field&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>SchemaForm&gt;</span><br></pre></td></tr></table></figure><br>具体可以参考官方案例：<a href="https://uform-next.netlify.com/#/9NCgCJ/8RCMC5hMhY" target="_blank" rel="noopener">Formily 简单场景</a></p>
<p><strong>Schema定义表单</strong></p>
<p>Schema定义表单是通过标准Json Schema描述表单信息，并传递给 SchameForm组件绘制出表单内容，当表单项比较多时，可以考虑使用这种方式。</p>
<p>Schema形式如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">   <span class="string">"type"</span>:<span class="string">"object"</span>,</span><br><span class="line">    <span class="string">"properties"</span>:&#123;</span><br><span class="line">        <span class="string">"aaa"</span>:&#123;</span><br><span class="line">            <span class="string">"type"</span>:<span class="string">"object"</span>,</span><br><span class="line">            <span class="string">"properties"</span>:&#123;</span><br><span class="line">                <span class="string">"bbb"</span>:&#123;</span><br><span class="line">                    <span class="string">"type"</span>:<span class="string">"string"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"ccc"</span>:&#123;</span><br><span class="line">                    <span class="string">"type"</span>:<span class="string">"array"</span>,</span><br><span class="line">                    <span class="string">"items"</span>:&#123;</span><br><span class="line">                        <span class="string">"type"</span>:<span class="string">"object"</span>,</span><br><span class="line">                        <span class="string">"properties"</span>:&#123;</span><br><span class="line">                            <span class="string">"ddd"</span>:&#123;</span><br><span class="line">                                <span class="string">"type"</span>:<span class="string">"string"</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;SchemaForm schema=&#123;schema&#125; /&gt;</span><br></pre></td></tr></table></figure><br>具体可参考官方案例：<a href="https://uform-next.netlify.com/#/9NCgCJ/8RCMC5hMhY" target="_blank" rel="noopener">Formily 简单场景</a></p>
<p><strong>使用场景</strong></p>
<p>Jsx和Json Schema都可以定义表单信息，但是在使用时需要编写的代码量和后期可维护性也是需要考虑的，通常在定义表单时可以参考以下情形区分使用这两种方式：</p>
<ul>
<li>包含大量表单布局（FormGrid、FormBlock、FormCard、FormStep、FormTab等），考虑使用Jsx，主要因为在Json Schema 中描述布局信息结点没有Jsx描述清晰，说明性不强、修改不是很方便。</li>
</ul>
<p>例如当有如下布局时，则使用Field描述：</p>
<p><img src="http://gw.aikan.miguvideo.com/ifs/img/1d50129222262c7795d3f42b3baecf82_layout.jpg" alt=""></p>
<p>代码示例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;FormBlock title=<span class="string">"办理配置"</span> name=<span class="string">"handleConfig"</span>&gt;</span><br><span class="line">    &lt;Field</span><br><span class="line">        required=&#123;required&#125;</span><br><span class="line">        editable=&#123;editable&#125;</span><br><span class="line">        title=<span class="string">"目标客户"</span></span><br><span class="line">        name=<span class="string">"targetCustomer"</span></span><br><span class="line">        type=<span class="string">"string"</span></span><br><span class="line">        description=&#123;useCount &gt; <span class="number">0</span> &amp;&amp; <span class="string">`共计<span class="subst">$&#123;useCount&#125;</span>人`</span>&#125;</span><br><span class="line">        enum=&#123;targetCustomerOptions&#125;</span><br><span class="line">        x-props=&#123;&#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">          mode: <span class="string">'multiple'</span>,</span><br><span class="line">          showSearch: <span class="literal">true</span>,</span><br><span class="line">          style: &#123;<span class="attr">width</span>: <span class="number">400</span>&#125;,</span><br><span class="line">          optionFilterProp: <span class="string">'label'</span>,</span><br><span class="line">          getPopupContainer: <span class="function"><span class="params">node</span> =&gt;</span> node.parentNode,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;Field</span><br><span class="line">        required=&#123;required&#125;</span><br><span class="line">        editable=&#123;editable&#125;</span><br><span class="line">        title=<span class="string">"用户办理方式"</span></span><br><span class="line">        name=<span class="string">"handleWay"</span></span><br><span class="line">        type=<span class="string">"radio"</span></span><br><span class="line">        enum=&#123;HANDLE_METHOD&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;Field</span><br><span class="line">        required=&#123;required&#125;</span><br><span class="line">        editable=&#123;editable&#125;</span><br><span class="line">        title=<span class="string">"小程序办理"</span></span><br><span class="line">        name=<span class="string">"apps"</span></span><br><span class="line">        type=<span class="string">"switch-field"</span></span><br><span class="line">        x-props=&#123;&#123;</span><br><span class="line">          message: <span class="string">'开启后可在小程序办理'</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;Field</span><br><span class="line">        required=&#123;required&#125;</span><br><span class="line">        editable=&#123;editable&#125;</span><br><span class="line">        title=<span class="string">"关联渠道"</span></span><br><span class="line">        name=<span class="string">"channel"</span></span><br><span class="line">        type=<span class="string">"string"</span></span><br><span class="line">        enum=&#123;channelOptions&#125;</span><br><span class="line">        x-props=&#123;&#123;</span><br><span class="line">          style: &#123;<span class="attr">width</span>: <span class="number">600</span>&#125;,</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">          showSearch: <span class="literal">true</span>,</span><br><span class="line">          showArrow: <span class="literal">false</span>,</span><br><span class="line">          optionFilterProp: <span class="string">'label'</span>,</span><br><span class="line">          getPopupContainer: <span class="function"><span class="params">node</span> =&gt;</span> node.parentNode,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;<span class="regexp">/FormBlock&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>当表单项较多，且不含或包含较少布局信息，推荐使用Json Schema描述，简洁方便，代码量少。</li>
</ul>
<p>例如在弹出框中的普通表单项，就可以使用Schema描述：</p>
<p><img src="http://gw.aikan.miguvideo.com/ifs/img/91e02461dd6fb9fca29f668a981429f1_layout2.jpg" alt=""></p>
<p>代码示例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    type: <span class="string">'object'</span>,</span><br><span class="line">    properties: &#123;</span><br><span class="line">      channelName: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line">        title: <span class="string">'渠道名称'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      channelNumber: &#123;</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line">        title: <span class="string">'渠道编号'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      operatorNumber: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line">        title: <span class="string">'操作员编号'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      regionCode: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        type: <span class="string">'city-cascader'</span>,</span><br><span class="line">        title: <span class="string">'地市'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请选择'</span>,</span><br><span class="line">          isShowProvince: <span class="literal">true</span>,</span><br><span class="line">          changeOnSelect: <span class="literal">true</span>,</span><br><span class="line">          onlyCity: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      channelLeaderName: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line">        title: <span class="string">'渠道负责人'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      channelLeaderMobile: &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        type: <span class="string">'string'</span>,</span><br><span class="line">        title: <span class="string">'负责人手机号'</span>,</span><br><span class="line">        <span class="string">'x-props'</span>: &#123;</span><br><span class="line">          placeholder: <span class="string">'请输入'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'x-rules'</span>: [</span><br><span class="line">          &#123; <span class="attr">validator</span>: validatorMobile &#125;, <span class="comment">// 这里是自定义的校验规则</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>数据绑定</strong></p>
<p>Formily表单数据会在form内部存储表单信息，当form不是受控组件时，开发完全不用关心数据如何存放，在使用时直接获取，不需要state来存储和维护表单状态，也不用在重渲染时的进行状态逻辑判断，避免了数据保存逻辑处理，也规避组件更新时的状态判断，使用非常方便。</p>
<p>Formily中的数据输入有三种形式，分别是value、defauleValue、initialValues，三者的区别和使用场景可以查看官方给出的文档说明：<a href="https://formilyjs.org/#/0yTeT0/0eSpSBTYIX" target="_blank" rel="noopener">value/defauleValue/initialValues属性使用场景</a></p>
<h3 id="表单联动">表单联动</h3><p>联动处理是Formily的一大核心亮点，其强大的表单联动是依赖于它的Effects副作用处理和路径系统，处理如一对多联动、多对一联动、多依赖联动、链式联动、循环联动、联动异步、数据转换、List列表联动等复杂场景都游刃有余，性能高效且使用方便。</p>
<p>关于路径系统相关内容，可以查看介绍：<a href="https://zhuanlan.zhihu.com/p/100780657" target="_blank" rel="noopener">10分钟解读UForm路径系统</a></p>
<p>关于联动处理介绍，可以查看官网介绍：<a href="https://formilyjs.org/#/0yTeT0/wWuyuJc6fO" target="_blank" rel="noopener">Formily 实现复杂联动逻辑</a></p>
<p><strong>联动处理</strong></p>
<p>部分场景中，在表单定义初始化时，或者在运行时对部分表单项需要执行动态隐藏/显示的问题，Formily提供了两个属性visible、display用于处理这列场景，这两者的区别如下：</p>
<ul>
<li>visible</li>
</ul>
<p>当visible为false时，表单项在UI上不显示，在表单实例中数据不再输出(实际数据还是存在，只是不再对外有任何表现)，在提交时，也拿不到该表单项的任何值；</p>
<ul>
<li>display</li>
</ul>
<p>当display为false时，表单项在UI上不显示，在表单实例中数据表现没有影响，在提交时，可以正常拿到该表单项的值；</p>
<p>使用这两个属性处理表单联动，可以解决提交过程中的字段逻辑判断过程，更方便简洁；</p>
<p>使用案例：<a href="https://codesandbox.io/s/visibledisplay-3wjcr" target="_blank" rel="noopener">visible/display的使用场景</a></p>
<ul>
<li>x-linkages</li>
</ul>
<p>Formily中新增加的x-linkages属性，支持配置简单的联动处理，有兴趣可以查看官网：<a href="https://formilyjs.org/#/0yTeT0/jYSxSwhmHa" target="_blank" rel="noopener">理解表单扩展机制</a></p>
<ul>
<li>其他联动</li>
</ul>
<p>Formily的联动功能非常强大，处理一对多联动、副作用校验、多依赖联、链式联动都很方便。具体请查看官网：<a href="https://formilyjs.org/#/0yTeT0/wWuyuJc6fO" target="_blank" rel="noopener">实现复杂联动逻辑</a></p>
<p><strong>Effects副作用处理</strong></p>
<p>Formily中的effects提供强大的副作用处理能力，修改数据、数据联动和异步请求等都可以完成，在SchemaFrom组件和Field组件都有对应的effects副作用处理逻辑</p>
<ul>
<li>SchemaFrom effects</li>
</ul>
<p>SchemaFrom中副作用处理是通过effects属性传递副作用处理函数，在内部监听表单事件，对各部分内容与表单数据进行处理（表单联动、数据项的改变等），目前实际项目中的副作用也是在SchemaFrom中进行处理的，具体可以参考官方案例：<a href="https://uform-next.netlify.com/#/9NCgCJ/4nuRuRS8Sj" target="_blank" rel="noopener">Uform 联动场景（V1.0）</a></p>
<ul>
<li>Field effects</li>
</ul>
<p>Field中的副作用处理是通过’x-effect’属性传递副作用处理函数，内部可以调用hook，或者通过dipatch发送action，并在SchemaFrom中进行处理，目前项目中用的比较少，具体可以查看官方案例：<a href="https://uform-next.netlify.com/#/9NCgCJ/4nuRuRS8Sj" target="_blank" rel="noopener">传动门</a></p>
<p>此外，可以通过Uform Hook自定义逻辑处理，而不需要在全局Effects中做控制，具体可以查看案例：<a href="https://codesandbox.io/s/hooks-mzzdf" target="_blank" rel="noopener">传送门</a></p>
<h3 id="表单布局">表单布局</h3><p>Formily中的布局方案比较多，利用FormLayout/FormItemGrid、FormCard/FormBlock、FormSlot、FormTextBox，FormSpy、FormStep以及FormTab等都可以实现如内联布局、复杂组合布局、网格布局、分步表单、选项卡表单等复杂的表单布局，当这些方案不满足业务需求是，也可以自定义表单布局。</p>
<p>布局方案官方案例地址：<a href="https://formilyjs.org/#/0yTeT0/jbUzUluaIG" target="_blank" rel="noopener">Formily 实现复杂布局</a></p>
<h3 id="特殊表单">特殊表单</h3><ul>
<li>表单List（array，cards，table）</li>
</ul>
<p>解决中后台项目中大量字段的聚合输入场景需求，如数组场景、区块型数组等场景。针对这种场景处理是一个痛点，通常是使用state/setState或React Hook操作大量数据来实现，缺少数据状态统一管理的解决方案，繁琐而且不易维护。所以在Formily中给我们提供了三种数组表单组件array、cards、table，用于管理表单list。</p>
<p>其解决方案可以查看下面几篇官方案例说明：<br><a href="https://uform-next.netlify.com/#/9NCgCJ/e3fef5h6hg" target="_blank" rel="noopener">表单List</a>、<br><a href="https://formilyjs.org/#/0yTeT0/w6idi5tdU1" target="_blank" rel="noopener">实现递归渲染组件</a>、<br><a href="https://formilyjs.org/#/0yTeT0/nvT5Tat8hO" target="_blank" rel="noopener">玩转自增列表组件</a>，当实际场景非常复杂是，也可以利用Formily提供的数据管理能力实现自定义组件，可以参考官方案例：<a href="https://formilyjs.org/#/0yTeT0/w6idi5tdU1" target="_blank" rel="noopener">实现递归渲染组件</a><br>、<a href="https://formilyjs.org/#/0yTeT0/A1T4TPhXUZ" target="_blank" rel="noopener">实现超复杂自定义组件</a></p>
<p>项目中的应用如图：<br><img src="http://gw.aikan.miguvideo.com/ifs/img/5d7822f15b3e6669a0445f706973f675_Table.jpg" alt=""></p>
<ul>
<li>FormStep步骤条</li>
</ul>
<p>FormStep即是一个表单项，也是一个表单布局组件，是将Antd Steps 步骤条和 Form 表单结合起来的一个组件。官方地址：<a href="https://formilyjs.org/#/0yTeT0/jbUzUluaIG" target="_blank" rel="noopener">分步表单</a></p>
<p>FormStep具有如下功能:</p>
<p>&emsp;&emsp;1).分割表单，让每一步就像一个SchemaForm表单；</p>
<p>&emsp;&emsp;2).状态保存，每一步的数据可以单独存储，返回时自动填充；</p>
<p>&emsp;&emsp;3).支持Effect监听，获取表单状态信息；</p>
<p>&emsp;&emsp;4).支持手动跳转（上一步、下一步、其他步骤）；</p>
<p>&emsp;&emsp;5).支持时间旅行；</p>
<p>&emsp;&emsp;6).提交时的数据是全部数据集合，不需要全局存储数据；</p>
<p>项目中的应用如图：<br><img src="http://gw.aikan.miguvideo.com/ifs/img/596a3ff02218d8c9e8ebfd3e775ca3bc_step1.jpg" alt=""></p>
<ul>
<li>FormSpy</li>
</ul>
<p>FormSpy本质上是简版的Redux表单组件，用于监听组件各种事件（form、field），通过reducer对数据进行处理，并返回最终的值，也可以配合FormProvider在表单外部消费表单信息，如监听表单/表单内部字段的变化、多表单提交等。具体可以查看官方FormSpy案例说明： <a href="https://uform-next.netlify.com/#/MpI2Ij/0viAi3Fjtw" target="_blank" rel="noopener">FormSpy</a></p>
<ul>
<li>FormTab</li>
</ul>
<p>FormTab是Formily新增加的整合Antd Tab选项卡表单组件，目前项目中使用的不多，具体使用请查看官方文档：<a href="https://formilyjs.org/#/0yTeT0/jbUzUluaIG" target="_blank" rel="noopener">选项卡表单</a></p>
<ul>
<li>自定义表单项</li>
</ul>
<p>Formily中自定义需要进行表单注册，注册的表单项，只需要实现value/onChange接口即可；</p>
<p>表单注册有两种形式，全局注册和实例注册，全局注册的表单项会在项目全局表单中生效，实例注册的表单项只对当前SchemaForm有效；具体可以查看最新官方说明：<a href="https://formilyjs.org/#/0yTeT0/jYSxSwhmHa" target="_blank" rel="noopener">理解表单扩展机制</a></p>
<h3 id="表单校验">表单校验</h3><p>Formily的表单校验是基于完备的校验引擎，提供了如registerValidationFormats、registerValidationMTEngine等方法用于注册全局共享的校验逻辑和校验模板，具体可查看官方API文档：<a href="https://formilyjs.org/#/zoi8i0/6dt3t7FjI4" target="_blank" rel="noopener">数据校验</a></p>
<ul>
<li>数据校验<ul>
<li>Json Schema校验</li>
<li>validateFirst校验</li>
<li>warning校验</li>
<li>失焦校验</li>
</ul>
</li>
<li>手工批量校验/手工清除校验消息</li>
<li>校验规则扩展/正则规则扩展</li>
<li>校验消息模板引擎</li>
<li>无UI表单校验</li>
</ul>
<h3 id="表单提交">表单提交</h3><ul>
<li>内部提交</li>
</ul>
<p>Formily内部提交数据，SchemFrom绑定提交方法onSubmit，内部通过Submit组件自动提交，具体可查看官方文档：<a href="https://uformjs.org/#/YZCyCk/7lC3CXsVhB" target="_blank" rel="noopener">表单提交</a></p>
<ul>
<li>外部提交</li>
</ul>
<p>Formily外部提交数据，可以通过Api createFromActions创建actions实例，在调用actions进行提交数据，也可以通过FormProvider和FormSpy（Uform之前是ForCustomer）进行提交，具体可以参考官网文档：<a href="https://formilyjs.org/#/zoi8i0/6dt3t7FjI4" target="_blank" rel="noopener">FormSpy</a></p>
<ul>
<li>多表单提交</li>
</ul>
<p>在某些情况下，页面中有多个Form表单实例一起提交数据，在Fromily中有两种解决方案：</p>
<ul>
<li><p>利用createFromActions创建多个actions实例，并绑定SchemaFrom表单，提交时调用actions.submit()提交多个表单数据</p>
</li>
<li><p>通过FormProvider和FormSpy，调用submit提交多表单数据（不过目前Formily提交有点问题，相信后续会解决），具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> onSubmit1 = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onSubmit1:"</span>, params)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> onSubmit2 = <span class="function"><span class="params">params</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onSubmit2:"</span>, params)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;FormProvider&gt;</span><br><span class="line">      &lt;SchemaForm onSubmit=&#123;onSubmit1&#125;&gt;</span><br><span class="line">        &lt;Field name=<span class="string">"name"</span> title=<span class="string">"年龄"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/SchemaForm&gt;</span></span><br><span class="line"><span class="regexp">      &lt;SchemaForm onSubmit=&#123;onSubmit2&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Field name="age" title="年龄" /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/SchemaForm&gt;</span></span><br><span class="line"><span class="regexp">      &lt;FormSpy&gt;</span></span><br><span class="line"><span class="regexp">        &#123;(&#123; form: spyForm &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          const handleSubmit = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            if (spyForm) &#123;</span></span><br><span class="line"><span class="regexp">              spyForm.submit()</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          return (</span></span><br><span class="line"><span class="regexp">            &lt;Button onClick=&#123;handleSubmit&#125; type="primary"&gt;</span></span><br><span class="line"><span class="regexp">              保存</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;<span class="regexp">/FormSpy&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>FormProvider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="表单复用（编辑/详情）">表单复用（编辑/详情）</h3><p>Formily在开发中提供了表单不同展示形态：编辑态和文本态，用于在不同状态下的信息展示，主要用于表单页和详情页，具体可查看官方案例：<a href="https://uform-next.netlify.com/#/9NCgCJ/8RCMC5hMhY" target="_blank" rel="noopener">状态变换</a></p>
<p>由于Formily给我们提供了非常简单的表单定义形式，当注册自定义表单项时，可以根据props中的disabled字段，自定义实现编辑态和文本态的不同显示状态</p>
<p>编辑态：<br><img src="http://gw.aikan.miguvideo.com/ifs/img/4f0e7b2419540e37039e0ff60088a9f8_Edit.jpg" alt=""></p>
<p>文本态：<br><img src="http://gw.aikan.miguvideo.com/ifs/img/0da8221ed80ab962365d4d0064872aa9_Text.jpg" alt=""></p>
<h3 id="支持Hook">支持Hook</h3><p>Formily是基于React16.8后的版本，已经全面使用hook来编写了，开发者可使用各种hook来使用Formily的特性。除了内置的生命周期，开发者还可以使用自定义Effects等一系列非常酷的特性 。(更多文档可参见<a href="https://formilyjs.org/#/zoi8i0/6dt3t7FjI4" target="_blank" rel="noopener">Formily Hook</a>），hooks是业务逻辑的抽象，用于简化视图的编写。</p>
<h2 id="总结">总结</h2><p>Formily有强大的表单处理能力，利用Rxjs的响应式能力处理各种表单联动逻辑，可以非常方便的开发表单应用。Formily有很多实践教程，可以多多查看: <a href="https://formilyjs.org/#/0yTeT0/zlcDcOsbhP" target="_blank" rel="noopener">实践教程</a></p>
<h2 id="参考文章">参考文章</h2><p><a href="https://zhuanlan.zhihu.com/uform" target="_blank" rel="noopener">UForm表单解决方案 - 知乎专栏</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/93859909" target="_blank" rel="noopener">UForm V1 要来了</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/94027681" target="_blank" rel="noopener">UForm技术内幕</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/100780657" target="_blank" rel="noopener">10分钟解读UForm路径系统</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/72007879" target="_blank" rel="noopener">UForm常见问题</a></p>
<p><a href="https://formilyjs.org/#/0yTeT0/VEt5tQHbh2" target="_blank" rel="noopener">性能优化实践</a></p>
<p><a href="https://formilyjs.org/#/0yTeT0/y9h0h4CLUe" target="_blank" rel="noopener">管理业务逻辑</a></p>
<p><a href="https://formilyjs.org/#/0yTeT0/zlcDcOsbhP" target="_blank" rel="noopener">玩转查询列表</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/12/Rxjs%E5%85%A5%E9%97%A8%E5%92%8C%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/12/Rxjs%E5%85%A5%E9%97%A8%E5%92%8C%E4%BD%BF%E7%94%A8/" itemprop="url">Rxjs学习入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-12T10:39:35+08:00">
                2019-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rxjs/" itemprop="url" rel="index">
                    <span itemprop="name">Rxjs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>by zhaowei 2019/12/19</p>
</blockquote>
<p>[TOC]</p>
<h2 id="前言">前言</h2><p>​    在学习Rxjs之前，先让我们先了解下<strong>函数式编程</strong>和<strong>响应式编程</strong>，<strong>观察者模式</strong>和<strong>迭代器模式</strong>，以及<strong>拉取 (Pull)</strong> 与<strong>推送 (Push)</strong><br>协议的区别</p>
<h3 id="函数式编程">函数式编程</h3><p> 函数式编程（通常简称为 FP）是指通过复合纯函数来构建软件的过程，它避免了共享的状态（share state）、易变的数据(mutable data)、以及副作用(side-effects)。</p>
<h3 id="响应式编程">响应式编程</h3><p>响应式编程（通常简称为 RP）是一种从数据流和变化出发的解决问题的模式。</p>
<h3 id="观察者模式">观察者模式</h3><p>观察者模式最常见的应用场景就是 Js Dom 事件的监听和触发<br>订阅：通过 addEventListener 订阅 document.body 的 click 事件<br>发布：当 body 节点被点击时，body 节点便会向订阅者发布这个消息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="title">listener</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.click(); <span class="comment">// 模拟用户点击</span></span><br></pre></td></tr></table></figure>
<h3 id="迭代器模式">迭代器模式</h3><p>迭代器模式可以用JavaScript 提供的Iterable Protocol可迭代协议来表示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> iterable = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">var</span> iterator = iterable[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = iterable();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = iterator.next(); <span class="comment">// &lt;= 获取下一个值</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        handleError(err); <span class="comment">// &lt;= 错误处理</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result.done) &#123;</span><br><span class="line">        handleCompleted(); <span class="comment">// &lt;= 无更多值（已完成）</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    doSomething(result.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要对应三种情况：</p>
<ul>
<li>获取下一个值：调用 next 将元素一个一个返回，可支持多次调用</li>
<li>已完成：无更多值时，next 返回元素中 done 为 true</li>
<li>错误处理：当 next 方式执行时报错，则会抛出 error 事件，用 try catch 包裹进行错误处理</li>
</ul>
<h3 id="拉取_(Pull)_vs-_推送_(Push)">拉取 (Pull) vs. 推送 (Push)</h3><p> 拉取和推送是两种不同的协议，用来描述数据生产者 (Producer)如何与数据消费者 (Consumer)进行通信的。</p>
<p><img src="./images/1.jpg" alt="avatar"></p>
<ul>
<li>Function 是惰性的评估运算，调用时会同步地返回一个单一值。</li>
<li>Generator 是惰性的评估运算，调用时会同步地返回零到(有可能的)无限多个值。</li>
<li>Promise 是最终可能(或可能不)返回单个值的运算。</li>
<li>Observable 是惰性的评估运算，它可以从它被调用的时刻起同步或异步地返回零到(有可能的)无限多个值。</li>
</ul>
<p>值得获取关系如下：</p>
<p><img src="./images/2.jpg" alt="avatar"></p>
<h2 id="RxJS基本概念">RxJS基本概念</h2><p>​RxJS 是 Reactive Extensions for JavaScript 的缩写，起源于 Reactive Extensions，是一个基于<strong>可观测数据流</strong>在异步编程应用中的库（可以理解为异步的lodash），是基于观察者模式和迭代器模式并以函数式编程来实现的库。</p>
<p>Rxjs使用Observables的响应式编程的库，可以更容易的编写异步货基于回调处理的代码，采用观察者模式、迭代器模式和函数编程思想，基于流的概念对数据进行处理</p>
<p>Rxjs基本概念如下：</p>
<ul>
<li><p><strong>Observable（可观察对象）</strong>： 表示一个概念，这个概念是一个可调用的未来值或事件的集合。</p>
</li>
<li><p><strong>Observer（观察者）</strong>： 一个回调函数的集合，它知道如何去监听由 Observable 提供的值。</p>
</li>
<li><p><strong>Subscription（订阅）</strong>：表示 Observable 的执行，它主要用于取消 Observable 的执行。</p>
</li>
<li><p><strong>Operator（操作）</strong>： 采用函数式编程风格的纯函数，使用像 map、filter、concat、flatMap 等这样的操作符来处理集合。</p>
</li>
<li><p><strong>Subject（主体）</strong>： 相当于 EventEmitter，并且是将值或事件多路推送给多个 Observer 的唯一方式。</p>
</li>
<li><p><strong>Schdulers（调度器）</strong>：用来控制并发并且是中央集权的调度员，允许我们在发生计算时进行协调，例如 setTimeout 或 requestAnimationFrame 或其他。</p>
</li>
</ul>
<h3 id="Observable_–_可观察对象">Observable – 可观察对象</h3><p>Observable 作为观察者，是一个值或事件的流集合，简单来说就是数据在 Observable 中流动，消费者可以使用各种 operator 对流进行处理，获取想要的结果。<br>observable 有三个方法：next，error，complete，分别发出不同类型的通知</p>
<p>创建 Observables<br>订阅 Observables<br>执行 Observables<br>清理 Observable 执行</p>
<h3 id="Observer_–_观察者">Observer – 观察者</h3><p>观察者是由 Observable 发送的值的消费者。<br>观察者只是一组回调函数的集合，每个回调函数对应一种 Observable 发送的通知类型：next、error 和 complete 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observer = &#123;</span><br><span class="line">    next: <span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Observer got a next value: '</span> + x),</span><br><span class="line">    error: <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">'Observer got an error: '</span> + err),</span><br><span class="line">    complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Observer got a complete notification'</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>​<br>使用观察者，需要把它提供给 Observable 的 subscribe 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(observer);</span><br></pre></td></tr></table></figure>
<h3 id="Subscription_-_订阅">Subscription - 订阅</h3><p>Subscription 是表示可清理资源的对象，通常是 Observable 的执行。Subscription 有一个重要的方法，即 unsubscribe，它不需要任何参数，只是用来清理由 Subscription 占用的资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observable = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">var</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line"><span class="comment">// 稍后：</span></span><br><span class="line"><span class="comment">// 这会取消正在进行中的 Observable 执行</span></span><br><span class="line"><span class="comment">// Observable 执行是通过使用观察者调用 subscribe 方法启动的</span></span><br><span class="line">subscription.unsubscribe();</span><br></pre></td></tr></table></figure>
<p>多个Subscription 还可以合在一起，这样一个 Subscription 调用 unsubscribe() 方法，可能会有多个 Subscription 取消订阅 。（涉及到多播的概念）</p>
<h3 id="Operators_-_操作符">Operators - 操作符</h3><p>操作符是 Observable 类型上的方法，比如 .map(…)、.filter(…)、.merge(…)，等等。当操作符被调用时，它们不会改变已经存在的 Observable 实例。相反，它们返回一个新的 Observable ，它的 subscription 逻辑基于第一个 Observable 。<br>操作符是函数，它基于当前的 Observable 创建一个新的 Observable。这是一个无副作用的操作：前面的 Observable 保持不变。</p>
<ul>
<li><p>1、创建数据流的操作符</p>
<ul>
<li>单值：of, empty, never</li>
<li>多值：from</li>
<li>定时：interval, timer</li>
<li>从事件创建：fromEvent</li>
<li>从 Promise 创建：fromPromise</li>
<li>自定义创建：create</li>
</ul>
</li>
<li><p>2、转换操作符</p>
<ul>
<li>改变数据形态：map, mapTo, pluck</li>
<li>过滤一些值：filter, skip, first, last, take</li>
<li>时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime</li>
<li>累加：reduce, scan</li>
<li>异常处理：throw, catch, retry, finally</li>
<li>条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn</li>
<li>转接：switchMap</li>
</ul>
</li>
<li><p>3、合并操作符</p>
<ul>
<li>concat，保持原来的序列顺序连接两个数据流</li>
<li>merge，合并序列</li>
<li>race，预设条件为其中一个数据流完成</li>
<li>forkJoin，预设条件为所有数据流都完成</li>
<li>zip，取各来源数据流最后一个值合并为对象</li>
<li>combineLatest，取各来源数据流最后一个值合并为数组</li>
</ul>
</li>
</ul>
<p>可以查看用例学习先关操作符：<a href="https://www.jianshu.com/p/59d64562daa0" target="_blank" rel="noopener">案例
</a></p>
<h3 id="Subject_–_主体">Subject – 主体</h3><p>RxJS Subject 是一种特殊类型的 Observable，它允许将值多播给多个观察者，所以 Subject 是多播的，而普通的 Observables 是单播的(每个已订阅的观察者都拥有 Observable 的独立执行)。<br>Subject 像是 Observable，但是可以多播给多个观察者。Subject 还像是 EventEmitters，维护着多个监听器的注册表。</p>
<p><strong>每个 Subject 都是 Observable</strong></p>
<ul>
<li>对于 Subject，你可以提供一个观察者并使用 subscribe 方法，就可以开始正常接收值。从观察者的角度而言，它无法判断 Observable 执行是来自普通的 Observable 还是 Subject 。在 Subject 的内部，subscribe 不会调用发送值的新执行。它只是将给定的观察者注册到观察者列表中，类似于其他库或语言中的 addListener 的工作方式。</li>
</ul>
<p><strong>每个 Subject 都是 Observer</strong></p>
<ul>
<li>Subject 是一个有如下方法的对象： next(v)、error(e) 和 complete() 。要给 Subject 提供新值，只要调用 next(theValue)，它会将值多播给已注册监听该 Subject 的观察者们。</li>
</ul>
<p>普通 Subject 没有缓存数据，订阅者在数据源发射数据之后订阅，是拿不到之前发射的值的，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅之前发射的值时拿不到的</span></span><br><span class="line">subject.next(<span class="string">'100'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅者在数据源发射数据之后订阅，拿不到之前的数据</span></span><br><span class="line">subject.subscribe(<span class="function"><span class="params">text</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'subscribeA:'</span>, text))</span><br><span class="line">subject.subscribe(<span class="function"><span class="params">text</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'subscribeB:'</span>, text))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅之后发射的值才能拿到</span></span><br><span class="line">subject.next(<span class="string">'200'</span>)</span><br><span class="line">subject.next(<span class="string">'300'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="./images/3.jpg" alt="avatar"></p>
<p>Subject 有几个子类，可以缓存部分或全部数据，在订阅时拿到数据执行处理，具体区别可以查看下面代码测试</p>
<p><strong>BehaviorSubject</strong></p>
<p>BehaviorSubject在创建时需要传递一个默认值，在订阅后会获取上一次发射的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BehaviorSubject 会存储最后一次发射的数据</span></span><br><span class="line"><span class="keyword">const</span> subject1 = <span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">subject1.next(<span class="number">1000</span>)</span><br><span class="line">subject1.next(<span class="number">2000</span>)</span><br><span class="line">subject1.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'BehaviorSubject subscribeA:'</span>, val))</span><br><span class="line">subject1.next(<span class="number">3000</span>)</span><br><span class="line">subject1.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'BehaviorSubject subscribeB:'</span>, val))</span><br><span class="line">subject1.next(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>
<p><img src="./images/4.jpg" alt="avatar"></p>
<p><strong>ReplaySubject</strong></p>
<p>ReplaySubject会缓存所有数据，当有新的订阅者的时候，发射缓存的所有值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subject2 = <span class="keyword">new</span> ReplaySubject()</span><br><span class="line"></span><br><span class="line">subject2.next(<span class="number">1000</span>)</span><br><span class="line">subject2.next(<span class="number">2000</span>)</span><br><span class="line">subject2.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ReplaySubject subscribeA:'</span>, val))</span><br><span class="line">subject2.next(<span class="number">3000</span>)</span><br><span class="line">subject2.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'ReplaySubject subscribeB:'</span>, val))</span><br><span class="line">subject2.next(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>
<p><img src="./images/5.jpg" alt="avatar"></p>
<p><strong>AsyncSubject</strong></p>
<p>AsyncSubject 和 BehaviorSubject 一样只会存储最后一次发出的数据，但是 AsyncSubject 只会在 complete 时把数据发射出去</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AsyncSubject 和 BehaviorSubject 一样只会存储最后一次发出的数据，但是 AsyncSubject 只会在 complete 时把数据发射出去</span></span><br><span class="line"><span class="keyword">const</span> subject4 = <span class="keyword">new</span> AsyncSubject()</span><br><span class="line">subject4.next(<span class="number">1000</span>)</span><br><span class="line">subject4.next(<span class="number">2000</span>)</span><br><span class="line">subject4.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'AsyncSubject subscribeA:'</span>, val))</span><br><span class="line">subject4.next(<span class="number">3000</span>)</span><br><span class="line">subject4.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'AsyncSubject subscribeB:'</span>, val))</span><br><span class="line">subject4.next(<span class="number">4000</span>)</span><br><span class="line">subject4.complete(); <span class="comment">// 只有在 complete 时把上一次缓存的值发射出去</span></span><br><span class="line"><span class="comment">// 会存储之前的值</span></span><br><span class="line">subject4.subscribe(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'AsyncSubject subscribeC:'</span>, val))</span><br><span class="line">subject4.next(<span class="number">5000</span>) <span class="comment">// 收不到 complete 之后的值</span></span><br></pre></td></tr></table></figure>
<p><img src="./images/6.jpg" alt="avatar"></p>
<p>四种 Subject 有各自的特性，可以根据下表来做详细区分</p>
<p><img src="./images/7.jpg" alt="avatar"></p>
<p>Subject相关内容查看案例：<a href="https://zhuanlan.zhihu.com/p/51493958" target="_blank" rel="noopener">RxJS 源码解读之 Subject
</a></p>
<h3 id="Schedulers_–_调度器">Schedulers – 调度器</h3><p>调度器控制着何时启动 subscription 和何时发送通知。它由三部分组成：</p>
<ul>
<li>调度器是一种数据结构。 它知道如何根据优先级或其他标准来存储任务和将任务进行排序。</li>
<li><p>调度器是执行上下文。 它表示在何时何地执行任务(举例来说，立即的，或另一种回调函数机制(比如 setTimeout 或 process.nextTick)，或动画帧)。</p>
</li>
<li><p>调度器有一个(虚拟的)时钟。 调度器功能通过它的 getter 方法 now() 提供了“时间”的概念。在具体调度器上安排的任务将严格遵循该时钟所表示的时间。</p>
</li>
</ul>
<p>调度器可以让你规定 Observable 在什么样的执行上下文中发送通知给它的观察者。</p>
<h2 id="总结">总结</h2><p>RxJS 是一个库，它通过使用 observable 序列来编写异步和基于事件的程序。可以把 RxJS 当做是用来处理事件的 Lodash 。RxJS 结合了 观察者模式、迭代器模式 和 使用集合的函数式编程，以满足以一种理想方式来管理事件序列所需要的一切。</p>
<p>Rxjs 可以处理多个数据对应的 complete 和 error 状态，但是 Rxjs 同时拥有 Next 方法，可以发射多个值，是对 Promise，callbacks，Web Workers，Web Sockets 进行统一的优化，一旦我们统一了这些概念后，将能更好地进行开发</p>
<p><strong>Rxjs生态</strong></p>
<p>Rxjs生态相对React，Vue，Angular等框架来说不算火，主要是因为学习成本比较高，但是各个框架都有对应的资源库支持，有兴趣可以详细研究</p>
<ul>
<li><p><a href="https://cn.rx.js.org/manual/usage.html" target="_blank" rel="noopener">Rxjs6官网</a></p>
</li>
<li><p><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">Rsjx操作符文档</a></p>
</li>
<li><p><a href="https://blog.csdn.net/Handsome_fan/article/details/82940875" target="_blank" rel="noopener">Angular Rxjs运用</a></p>
</li>
<li><p><a href="https://juejin.im/entry/5bfdf27a6fb9a049a7118314" target="_blank" rel="noopener">React rxjs-hook</a></p>
</li>
<li><p><a href="https://juejin.im/post/5c9c79d0f265da610763090d" target="_blank" rel="noopener">redux-observable</a></p>
</li>
<li><p><a href="https://juejin.im/entry/582678b68ac24700595fdc2d" target="_blank" rel="noopener">探秘 vue-rx 2.0</a></p>
</li>
<li><p><a href="https://github.com/pubkey/rxdb" target="_blank" rel="noopener">rxdb</a></p>
</li>
</ul>
<p><strong>Rxjs使用场景</strong></p>
<ul>
<li>异步请求</li>
<li>页面滚动事件（原生实现做节流处理）</li>
<li>交互处理（自动搜索、拖拽实现）</li>
<li>项目数据管理 实践案例<a href="https://zhuanlan.zhihu.com/p/28958042" target="_blank" rel="noopener">（DaoCloud 基于 RxJS 的前端数据层实践 ）</a></li>
</ul>
<h2 id="参考文章">参考文章</h2><ul>
<li><p><a href="https://www.jianshu.com/p/5d01341599e9" target="_blank" rel="noopener">RxJS 介绍</a></p>
</li>
<li><p><a href="https://rxjs-cn.github.io/learn-rxjs-operators/" target="_blank" rel="noopener">学习 RxJS 操作符</a></p>
</li>
<li><p><a href="https://cn.rx.js.org/" target="_blank" rel="noopener">Rxjs 官网中文版</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/28958042" target="_blank" rel="noopener">DaoCloud 基于 RxJS 的前端数据层实践</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/35457418" target="_blank" rel="noopener">RxJS 游戏之贪吃蛇</a></p>
</li>
<li><p><a href="http://cyclejs.cn/" target="_blank" rel="noopener">函数式和响应式的 JavaScript 框架，编写可观测代码 Cycle.js</a></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/12/Puppeteer%20%E5%85%A5%E9%97%A8%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵伟">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="前端小谁谁">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/12/Puppeteer%20%E5%85%A5%E9%97%A8%E4%B8%8E%E4%BD%BF%E7%94%A8/" itemprop="url">Puppeteer 入门与使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-12T10:39:35+08:00">
                2019-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Node/" itemprop="url" rel="index">
                    <span itemprop="name">Node</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>by zhaowei 2019/12/19<br><img src="https://pptr.dev/images/pptr.png" alt=""></p>
</blockquote>
<blockquote>
<p>图片来源：<a href="https://pptr.dev/images/pptr.png" target="_blank" rel="noopener">https://pptr.dev/images/pptr.png</a></p>
</blockquote>
<p>[TOC]</p>
<h1 id="前言">前言</h1><p>在学习Puppeteer之前，我们先来了解下什么是Headless Chrome，Headless Chrome能做些什么</p>
<p>Headless是Chrome在17年自行开发的特性，支持以下功能：</p>
<ol>
<li>在无界面的环境中运行 Chrome</li>
<li>通过命令行或者程序语言操作 Chrome</li>
<li>无需人的干预，运行更稳定</li>
<li>在启动 Chrome 时添加参数 –headless，便可以 headless 模式启动 Chrome</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> chrome=<span class="string">"/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mac OS X 命令别名</span></span><br><span class="line">chrome --headless --remote-debugging-port=9222 --<span class="built_in">disable</span>-gpu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启远程调试</span></span><br><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --dump-dom https://www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取页面 DOM</span></span><br><span class="line">chrome --headless --<span class="built_in">disable</span>-gpu --screenshot https://www.baidu.com</span><br></pre></td></tr></table></figure>
<h1 id="正文">正文</h1><p>基于Chrome Handless特性，Chrome推出了Puppeteer node包，是对Chrome的无界面版本以及对其进行操作的js接口封装，通过调用Chrome DevTools开放的接口与Chrome通信，使得我们可以非常方便的操作Chrome。</p>
<h2 id="Puppeteer_简介">Puppeteer 简介</h2><p>Puppeteer 是一个node库，他提供了一组用来操纵Chrome的API, 通俗来说就是一个 headless chrome浏览器 (当然你也可以配置成有UI的，默认是没有的)。既然是浏览器，那么我们手工可以在浏览器上做的事情 Puppeteer 都能胜任, 另外，Puppeteer 翻译成中文是”木偶”意思，所以听名字就知道，操纵起来很方便，你可以很方便的操纵她去实现：</p>
<ol>
<li>生成网页截图或者 PDF</li>
<li>高级爬虫，可以爬取大量异步渲染内容的网页</li>
<li>模拟键盘输入、表单自动提交、登录网页等，实现 UI 自动化测试</li>
<li>捕获站点的时间线，以便追踪你的网站，帮助分析网站性能问题</li>
</ol>
<p>Chrome Headless 特性，意思是在无界面的环境下运行Chrome，可以通过命令行或者程序语言操作Chrome</p>
<h2 id="Puppeteer_安装">Puppeteer 安装</h2><p>在安装Puppeteer包时，可能会遇到chromium安装失败的情况（原因你懂的），遇到这种情况，我们可以自行下载 chromium 浏览器进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install puppeteer-chromium-resolver</span><br></pre></td></tr></table></figure>
<p>成功后会显示安装路径，记住这个安装路径，在后面会用到<br><img src="https://global.uban360.com/sfs/file?digest=fidf0a263b4410182e9966687795f732c39&amp;fileType=2" alt=""></p>
<p>浏览器安装成功之后，继续安装 puppeteer 时可以通过set PUPPETEER_SKIP_CHROMIUM_DOWNLOAD 跳过下载过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="built_in">set</span> PUPPETEER_SKIP_CHROMIUM_DOWNLOAD <span class="literal">true</span></span><br><span class="line">npm install puppeteer</span><br></pre></td></tr></table></figure>
<p>不过更推荐安装 puppeteer-core，不会下载 chromium，而且包体积会更小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install puppeteer-core</span><br></pre></td></tr></table></figure>
<h2 id="玩转_Chrome_Handless">玩转 Chrome Handless</h2><p>puppeteer安装完成之后，我们就可以利用puppeteer 操作 Chrome，详细api可以查看操作文档：<a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-class-puppeteer" target="_blank" rel="noopener">Puppeteer</a></p>
<p>首先打开浏览器并跳转到指定页面，需要用到上面 chromium 的安装路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer-core'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> launch_options = &#123;</span><br><span class="line">  <span class="comment">// 启动模式： true 无头模式</span></span><br><span class="line">  headless: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 可运行 Chromium 或 Chrome 可执行文件的路径，这里就是上面 Chromium 的安装路径</span></span><br><span class="line">  executablePath:</span><br><span class="line">    <span class="string">"安装路径"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 开启浏览器</span></span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(launch_options)</span><br><span class="line">  <span class="comment">// 开启一个tab页</span></span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">  <span class="comment">// 跳转到百度首页</span></span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">'http:/www.baidu.com'</span>)</span><br><span class="line">  <span class="comment">// 关闭页面</span></span><br><span class="line">  <span class="keyword">await</span> page.close()</span><br><span class="line">  <span class="comment">// 关闭浏览器</span></span><br><span class="line">  <span class="keyword">await</span> browser.close()</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>我们这里为了查看效果配置了headless为false，表示不使用无头模式，可以用来调试项目，其他关于 browser和page的配置可以查看 <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-class-browser" target="_blank" rel="noopener">文档</a>。</p>
<p>运行之后会打开浏览器并新建tab页，跳转到百度首页，之后会自动关掉</p>
<p><img src="https://global.uban360.com/sfs/file?digest=fid5135c500200de8d7661ba6d8fe0acb62&amp;fileType=2" alt=""></p>
<p>浏览器运行起来之后我们就可以来做下面这些事情了</p>
<h3 id="生成网页截图或者PDF">生成网页截图或者PDF</h3><p>网页截图在Chrome浏览器中是可以调用命令导出png图片的，f12打开开发面板，ctrl + shift + p打开命令行窗口，输入 screenshot 关键字搜索命令，就可以截取当前页面了</p>
<p><img src="https://global.uban360.com/sfs/file?digest=fid05095d8137131f6e5e4ca165bc5e1577&amp;fileType=2" alt=""></p>
<p>而通过代码也是很方便的截图</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 截图</span></span><br><span class="line"> <span class="keyword">await</span> page.screenshot(&#123;</span><br><span class="line">   path: <span class="string">'./baidu.png'</span></span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<p>运行之后会在当前目录下生成 baidu.png，当然他还支持有页面任意范围的截图，其他详细配置可以查看 <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-pagescreenshotoptions" target="_blank" rel="noopener">文档</a></p>
<p>而puppeteer导出pdf也非常简单，一行代码搞定</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pdf</span></span><br><span class="line"><span class="keyword">await</span> page.pdf(&#123;</span><br><span class="line">   path: <span class="string">'./baidu.pdf'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在导出pdf时，可以通过设置css的媒体模式为 screen 优化导出效果，具体可以查看 <a href="">文档</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> Global.page.emulateMediaType(<span class="string">'screen'</span>); <span class="comment">// 'screen', 'print' 和 null</span></span><br></pre></td></tr></table></figure>
<p>运行完毕当前目录下就会生成 pdf 文件，但要注意的是 puppeteer 导出pdf必须是在无头模式下，即 headless 必须为 true，否则会报错。关于其他导出pdf的配置可以查看 <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-pagepdfoptions" target="_blank" rel="noopener">文档</a></p>
<p>当然如果是需要导出doc或execl等文件，可以运行 js 脚本进行下载，可以通过设置指定下载目录，保存我们的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定文件下载路径</span></span><br><span class="line">	<span class="keyword">await</span> Global.page._client.send(<span class="string">'Page.setDownloadBehavior'</span>, &#123;</span><br><span class="line">		behavior: <span class="string">'allow'</span>,</span><br><span class="line">		downloadPath: <span class="string">"下载路径"</span>, <span class="comment">// 建议使用绝对路径</span></span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="高级爬虫，可以爬取大量异步渲染内容的网页">高级爬虫，可以爬取大量异步渲染内容的网页</h3><p>利用puppeteer可以在不打开浏览器（即无头模式下）对网站中的页面爬虫爬取数据，更多的是拉取页面上的图片、媒体的等各种资源，网上案例很多，可自行查阅。</p>
<p>我们目前项目里面用到的是插入markdown渲染之后的html代码，并插入执行js脚本，主要用到下面几个方法：</p>
<p>插入html文档</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置html content</span></span><br><span class="line"><span class="keyword">await</span> Global.page.setContent(html, &#123;</span><br><span class="line">	waitUntil: <span class="string">'domcontentloaded'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入以来的css代码段或者文件</span></span><br><span class="line"><span class="keyword">await</span> Global.page.addStyleTag(&#123;</span><br><span class="line">	path: path.resolve(__dirname, <span class="string">'assets/markdown.css'</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>向指定dom插入html片段<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定位置插入插入 html 片段</span></span><br><span class="line"><span class="keyword">await</span> Global.page.$<span class="built_in">eval</span>(<span class="string">'#content'</span>, (dom, html) =&gt; &#123;</span><br><span class="line">	dom.innerHTML = html</span><br><span class="line">&#125;, html);</span><br></pre></td></tr></table></figure></p>
<p>插入js外部库<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> Global.page.addScriptTag(&#123;</span><br><span class="line">	path: path.resolve(__dirname, <span class="string">'lib/waterMask.js'</span>),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>执行js脚本<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> Global.page.evaluate(<span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">window</span>.waterMark) &#123;</span><br><span class="line">		<span class="built_in">window</span>.waterMark(&#123;</span><br><span class="line">			text</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, watermark)</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是 page.evaluate* 等方法都是可以传递外部参数的，插入的js脚本是运行在浏览器端，在访问一些库如jquery等时可能需要显示使用 window 命名空间，否则node可能会校验变量为定义。如果内部返回的是Promise，node端也是可以拿到数据的</p>
<h3 id="模拟键盘输入、表单自动提交、登录网页等，实现_UI_自动化测试">模拟键盘输入、表单自动提交、登录网页等，实现 UI 自动化测试</h3><p>模拟键盘输入、表单自动提交、登录网页等，实现 UI 自动化测试说白了就是定位到页面元素，触发dom事件，使用 puppeteer 中 page 的下面方法可以很轻松的做到，具体可自行查阅</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">page.$(selector)</span><br><span class="line">page.$$(selector)</span><br><span class="line">page.$$<span class="built_in">eval</span>(selector, pageFunction[, ...args])</span><br><span class="line">page.$<span class="built_in">eval</span>(selector, pageFunction[, ...args])</span><br><span class="line">page.$x(expression)</span><br></pre></td></tr></table></figure>
<p>表单自动提交等案例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动填充表单数据</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">'mayanjun@haowumc.com'</span>;</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'.text.pristine.untouched'</span>, name, &#123;<span class="attr">delay</span>: <span class="number">0</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> pwd = <span class="string">'密码'</span>;</span><br><span class="line"><span class="keyword">await</span> page.type(<span class="string">'.text.pristine.untouched'</span>, pwd, &#123;<span class="attr">delay</span>: <span class="number">1</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发表单提交</span></span><br><span class="line"><span class="keyword">const</span> inputElement = <span class="keyword">await</span> page.$(<span class="string">'input[type=submit]'</span>);</span><br><span class="line"><span class="keyword">await</span> inputElement.click();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待浏览器跳转</span></span><br><span class="line"><span class="keyword">await</span> page.waitForNavigation();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(page.url());</span><br><span class="line"><span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">	waitUntil: <span class="string">'networkidle2'</span>  <span class="comment">// 网络空闲说明已加载完毕</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>关于 page.$*的各种api，用法jquery差不多，有兴趣可以查看 <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-pageselector" target="_blank" rel="noopener">文档</a></p>
<h3 id="捕获站点的时间线，以便追踪你的网站，帮助分析网站性能问题">捕获站点的时间线，以便追踪你的网站，帮助分析网站性能问题</h3><p>chrome自身带有监控工具，可以查看收集到各种资源请求的结果、耗时操作以及错误警告等信息，通过 puppeteer 的 Events api可以监听到页面中的很多信息，很方便的帮助我们追踪网站、帮助分析网站性能问题，也有很多前端团队基于 puppeteer 做自己的监控工具，更多信息可以查看 <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=api-class-page" target="_blank" rel="noopener">文档</a>。</p>
<p><img src="https://global.uban360.com/sfs/file?digest=fid71e95eafffa3f73d4224fb76b19dfc83&amp;fileType=2" alt=""></p>
<h1 id="总结">总结</h1><p>chrome浏览器功能很强大，基于 chrome 的 Headless 特性在node端也可以模拟实现前端页面中的各种神奇操作，达到我们的预期效果，但同时Headless Chrome 会占用大量的资源，特别是跑其他应用的服务器上时，无头浏览器的行为难以预测，目前线上应用更多的都是使用 docker 来管理 Chrome，构建定制镜像，在容器中运行，确保 Chrome 的稳定状态。</p>
<h1 id="参考文章">参考文章</h1><ul>
<li>[1] <a href="https://zhuanlan.zhihu.com/p/66296309" target="_blank" rel="noopener">爬虫利器 Puppeteer 的一些最佳实践</a></li>
<li>[2] <a href="https://blog.csdn.net/zhai_865327/article/details/104792646" target="_blank" rel="noopener">puppeteer 生成pdf，绝对解决你的需求</a></li>
<li>[3] <a href="https://zhuanlan.zhihu.com/p/76237595" target="_blank" rel="noopener">结合项目来谈谈 Puppeteer</a></li>
<li>[4] <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#?product=Puppeteer&amp;version=v5.3.1&amp;show=outline" target="_blank" rel="noopener">puppeteer 文档</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">赵伟</p>
              <p class="site-description motion-element" itemprop="description">前段杂货铺，正在储货中...</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵伟</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
